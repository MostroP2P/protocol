<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Mostro messages specs</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="overview.html">Home</a></li><li class="chapter-item expanded "><a href="new_sell_order.html"><strong aria-hidden="true">1.</strong> Creating a Sell order</a></li><li class="chapter-item expanded "><a href="new_sell_range_order.html"><strong aria-hidden="true">2.</strong> Creating a Sell range order</a></li><li class="chapter-item expanded "><a href="new_buy_order.html"><strong aria-hidden="true">3.</strong> Creating a Buy order</a></li><li class="chapter-item expanded "><a href="new_buy_order_ln_address.html"><strong aria-hidden="true">4.</strong> Creating a Buy order with a LN address</a></li><li class="chapter-item expanded "><a href="list_orders.html"><strong aria-hidden="true">5.</strong> List orders</a></li><li class="chapter-item expanded "><a href="take_sell.html"><strong aria-hidden="true">6.</strong> Take sell order</a></li><li class="chapter-item expanded "><a href="take_sell_ln_address.html"><strong aria-hidden="true">7.</strong> Take sell order with a LN address</a></li><li class="chapter-item expanded "><a href="take_sell_range_order.html"><strong aria-hidden="true">8.</strong> Take range sell order</a></li><li class="chapter-item expanded "><a href="take_buy.html"><strong aria-hidden="true">9.</strong> Take buy order</a></li><li class="chapter-item expanded "><a href="take_buy_range_order.html"><strong aria-hidden="true">10.</strong> Take range buy order</a></li><li class="chapter-item expanded "><a href="seller_pay_hold_invoice.html"><strong aria-hidden="true">11.</strong> Seller pays hold invoice</a></li><li class="chapter-item expanded "><a href="fiatsent.html"><strong aria-hidden="true">12.</strong> Fiat sent</a></li><li class="chapter-item expanded "><a href="release.html"><strong aria-hidden="true">13.</strong> Release</a></li><li class="chapter-item expanded "><a href="user_rating.html"><strong aria-hidden="true">14.</strong> Rate user</a></li><li class="chapter-item expanded "><a href="cancel.html"><strong aria-hidden="true">15.</strong> Cancel</a></li><li class="chapter-item expanded "><a href="dispute.html"><strong aria-hidden="true">16.</strong> Dispute</a></li><li class="chapter-item expanded "><a href="list_disputes.html"><strong aria-hidden="true">17.</strong> List disputes</a></li><li class="chapter-item expanded "><a href="admin_settle_order.html"><strong aria-hidden="true">18.</strong> Admin Settle order</a></li><li class="chapter-item expanded "><a href="admin_cancel_order.html"><strong aria-hidden="true">19.</strong> Admin Cancel order</a></li><li class="chapter-item expanded "><a href="admin_add_solver.html"><strong aria-hidden="true">20.</strong> Admin Add Solver</a></li><li class="chapter-item expanded "><a href="actions.html"><strong aria-hidden="true">21.</strong> Actions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="message_suggestions_for_actions.html"><strong aria-hidden="true">21.1.</strong> Message suggestions for actions</a></li></ol></li><li class="chapter-item expanded "><a href="order-event.html"><strong aria-hidden="true">22.</strong> Order event</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Mostro messages specs</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="mostro-specification-for-clients"><a class="header" href="#mostro-specification-for-clients">Mostro specification for clients</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>In order to have a shared order's book, Mostro daemon send <a href="https://github.com/nostr-protocol/nips/blob/master/01.md#kinds">Parameterized Replaceable Events</a> with <code>38383</code> as event <code>kind</code>, you can find more details about that specific event <a href="./order-event.html">here</a></p>
<h2 id="communication-between-users-and-mostro"><a class="header" href="#communication-between-users-and-mostro">Communication between users and Mostro</a></h2>
<p>All messages from/to Mostro should be <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">Gift wrap Nostr events</a>, the <code>content</code> of the <code>rumor</code> event should be a nip44 encrypted JSON-serialized string (with no white space or line breaks) of the following structure:</p>
<ul>
<li><code>version</code>: Version of the protocol, currently <code>1</code></li>
<li><a href="https://docs.rs/mostro-core/latest/mostro_core/message/enum.Action.html">action</a>: Action to be performed by Mostro daemon</li>
<li><a href="https://docs.rs/mostro-core/latest/mostro_core/message/enum.Content.html">content</a> (optional): Content of the message, this field is optional and depends on the action</li>
</ul>
<p>These fields are relative to the wrapper, here an example of a <code>fiat-sent</code> Order message, in this case <code>id</code> is the Order Id:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;fiat-sent&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<h2 id="keys"><a class="header" href="#keys">Keys</a></h2>
<p>For all examples the participants will use this keys:</p>
<ul>
<li>Mostro's pubkey <code>dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a</code></li>
<li>Seller's ephemeral pubkey <code>00000ba40c5795451705bb9c165b3af93c846894d3062a9cd7fcba090eb3bf78</code></li>
<li>Buyer's ephemeral pubkey <code>0000147e939bef2b81c27af4c1b702c90c3843f7212a34934bff1e049b7f1427</code></li>
</ul>
<h2 id="ephemeral-keys"><a class="header" href="#ephemeral-keys">Ephemeral keys</a></h2>
<p>Mostro clients should implement nip59 which creates newly fresh keys on each message to Mostro, the client will also creates newly keys for each order and is used to sign the seal, this pubkey will be linked to the order and discarded after the trade is done, this pubkey also will be used in case of a dispute.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-a-new-sell-order"><a class="header" href="#creating-a-new-sell-order">Creating a new sell order</a></h1>
<p>To create a new sell order the user should send a Gift wrap Nostr event to Mostro, the rumor event should have the following rumor's content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;action&quot;: &quot;new-order&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;kind&quot;: &quot;sell&quot;,
        &quot;status&quot;: &quot;pending&quot;,
        &quot;amount&quot;: 0,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;min_amount&quot;: null,
        &quot;max_amount&quot;: null,
        &quot;fiat_amount&quot;: 100,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;created_at&quot;: 0
      }
    }
  }
}
</code></pre>
<p>Let's explain some of the fields:</p>
<ul>
<li>kind: <code>sell</code> or <code>buy</code></li>
<li>status: Is always <code>pending</code> when creating a new order</li>
<li>amount: 0 for when we want to sell with at market price, otherwise the amount in satoshis</li>
<li>created_at: No need to send the correct unix timestamp, Mostro will replace it with the current time</li>
</ul>
<p>The event to send to Mostro would look like this:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;cade205b849a872d74ba4d2a978135dbc05b4e5f483bb4403c42627dfd24f67d&quot;,
  &quot;kind&quot;: 1059,
  &quot;pubkey&quot;: &quot;1f5bb148a25bca31506594722e746b10acf2641a12725b12072dcbc46ade544d&quot;, // Seller's ephemeral pubkey
  &quot;content&quot;: &quot;sealed-rumor-content&quot;,
  &quot;tags&quot;: [
    [&quot;p&quot;, &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;] // Mostro's pubkey
  ],
  &quot;created_at&quot;: 1234567890,
  &quot;sig&quot;: &quot;a21eb195fe418613aa9a3a8a78039b090e50dc3f9fb06b0f3fe41c63221adc073a9317a1f28d9db843a43c28d860ba173b70132ca85b0e706f6487d43a57ee82&quot;
}
</code></pre>
<h2 id="confirmation-message"><a class="header" href="#confirmation-message">Confirmation message</a></h2>
<p>Mostro will send back a nip59 event as a confirmation message to the user like the following (unencrypted rumor's content example):</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;new-order&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
        &quot;kind&quot;: &quot;sell&quot;,
        &quot;status&quot;: &quot;pending&quot;,
        &quot;amount&quot;: 0,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;fiat_amount&quot;: 100,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;created_at&quot;: 1698870173
      }
    }
  }
}
</code></pre>
<p>Mostro publishes this order as an event kind <code>38383</code> with status <code>pending</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;84fad0d29cb3529d789faeff2033e88fe157a48e071c6a5d1619928289420e31&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702548701,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;pending&quot;],
      [&quot;amt&quot;, &quot;0&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;, &quot;bank transfer&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;7e8fe1eb644f33ff51d8805c02a0e1a6d034e6234eac50ef7a7e0dac68a0414f7910366204fa8217086f90eddaa37ded71e61f736d1838e37c0b73f6a16c4af2&quot;
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-a-new-sell-range-order"><a class="header" href="#creating-a-new-sell-range-order">Creating a new sell range order</a></h1>
<p>To create a new range order the user should send a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;action&quot;: &quot;new-order&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;kind&quot;: &quot;sell&quot;,
        &quot;status&quot;: &quot;pending&quot;,
        &quot;amount&quot;: 0,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;min_amount&quot;: 10,
        &quot;max_amount&quot;: 20,
        &quot;fiat_amount&quot;: 0,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;created_at&quot;: 0
      }
    }
  }
}
</code></pre>
<p>Here we have two new fields, <code>min_amount</code> and <code>max_amount</code>, to define the range of the order. The <code>fiat_amount</code> field is set to 0 to indicate that the order is for a range of amounts.</p>
<p>When a taker takes the order, the amount will be set on the message.</p>
<h2 id="confirmation-message-1"><a class="header" href="#confirmation-message-1">Confirmation message</a></h2>
<p>Mostro will send back a nip59 event as a confirmation message to the user like the following:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;new-order&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
        &quot;kind&quot;: &quot;sell&quot;,
        &quot;status&quot;: &quot;pending&quot;,
        &quot;amount&quot;: 0,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;min_amount&quot;: 10,
        &quot;max_amount&quot;: 20,
        &quot;fiat_amount&quot;: 0,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;created_at&quot;: 1698870173
      }
    }
  }
}
</code></pre>
<p>Mostro publishes this order as an event kind <code>38383</code> with status <code>pending</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;84fad0d29cb3529d789faeff2033e88fe157a48e071c6a5d1619928289420e31&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702548701,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;pending&quot;],
      [&quot;amt&quot;, &quot;0&quot;],
      [&quot;fa&quot;, &quot;10&quot;, &quot;20&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;7e8fe1eb644f33ff51d8805c02a0e1a6d034e6234eac50ef7a7e0dac68a0414f7910366204fa8217086f90eddaa37ded71e61f736d1838e37c0b73f6a16c4af2&quot;
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-a-new-buy-order"><a class="header" href="#creating-a-new-buy-order">Creating a new buy order</a></h1>
<p>To create a new buy order the user should send a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;action&quot;: &quot;new-order&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;kind&quot;: &quot;buy&quot;,
        &quot;status&quot;: &quot;pending&quot;,
        &quot;amount&quot;: 0,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;fiat_amount&quot;: 100,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;created_at&quot;: 0
      }
    }
  }
}
</code></pre>
<p>The nostr event will look like this:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;cade205b849a872d74ba4d2a978135dbc05b4e5f483bb4403c42627dfd24f67d&quot;,
  &quot;kind&quot;: 1059,
  &quot;pubkey&quot;: &quot;9a42ac72d6466a6dbe5b4b07a8717ee13e55abb6bdd810ea9c321c9a32ee837b&quot;, // Buyer's ephemeral pubkey
  &quot;content&quot;: &quot;sealed-rumor-content&quot;,
  &quot;tags&quot;: [
    [&quot;p&quot;, &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;] // Mostro's pubkey
  ],
  &quot;created_at&quot;: 1234567890,
  &quot;sig&quot;: &quot;a21eb195fe418613aa9a3a8a78039b090e50dc3f9fb06b0f3fe41c63221adc073a9317a1f28d9db843a43c28d860ba173b70132ca85b0e706f6487d43a57ee82&quot;
}
</code></pre>
<h2 id="confirmation-message-2"><a class="header" href="#confirmation-message-2">Confirmation message</a></h2>
<p>Mostro will send back a nip59 event as a confirmation message to the user like the following:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;new-order&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
        &quot;kind&quot;: &quot;buy&quot;,
        &quot;status&quot;: &quot;pending&quot;,
        &quot;amount&quot;: 0,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;fiat_amount&quot;: 100,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;master_buyer_pubkey&quot;: null,
        &quot;master_seller_pubkey&quot;: null,
        &quot;buyer_invoice&quot;: null,
        &quot;created_at&quot;: 1698870173
      }
    }
  }
}
</code></pre>
<p>Mostro publishes this order as an event kind <code>38383</code> with status <code>pending</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;84fad0d29cb3529d789faeff2033e88fe157a48e071c6a5d1619928289420e31&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702548701,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;buy&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;pending&quot;],
      [&quot;amt&quot;, &quot;0&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;7e8fe1eb644f33ff51d8805c02a0e1a6d034e6234eac50ef7a7e0dac68a0414f7910366204fa8217086f90eddaa37ded71e61f736d1838e37c0b73f6a16c4af2&quot;
  }
]
</code></pre>
<p>After a seller takes this order Mostro will request an invoice from the buyer, Mostro will pay the buyer's invoice when the seller releases the funds.</p>
<h2 id="creating-the-order-with-a-lightning-invoice"><a class="header" href="#creating-the-order-with-a-lightning-invoice">Creating the order with a lightning invoice</a></h2>
<p>There are two ways where the buyer can create the order adding the invoice:</p>
<ol>
<li>
<p>If the buyer already knows the amount, e.g. buyer wants to buy 15000 sats with 10 euros, in this case the buyer knows from the beginning that the invoice should have amount 15000 - Mostro's fee, instead of the user doing the calculation, the client must do it and in some cases create the invoice with the right amount.</p>
</li>
<li>
<p>If the buyer don't know the amount, e.g. buyer wants to buy sats with 10 euros, in this case the buyer can add an amountless invoice and Mostro will pay it with the market price amount - Mostro's fee automatically.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-a-new-order"><a class="header" href="#creating-a-new-order">Creating a new order</a></h1>
<p>Creating buy order with a <a href="https://github.com/andrerfneves/lightning-address">lightning address</a> would make the process way faster and easy going, to acomplish the buyer should send a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;action&quot;: &quot;new-order&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;kind&quot;: &quot;buy&quot;,
        &quot;status&quot;: &quot;pending&quot;,
        &quot;amount&quot;: 0,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;fiat_amount&quot;: 100,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;buyer_invoice&quot;: &quot;mostro_p2p@ln.tips&quot;,
        &quot;created_at&quot;: 0
      }
    }
  }
}
</code></pre>
<p>The nostr event will look like this:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;cade205b849a872d74ba4d2a978135dbc05b4e5f483bb4403c42627dfd24f67d&quot;,
  &quot;kind&quot;: 1059,
  &quot;pubkey&quot;: &quot;9a42ac72d6466a6dbe5b4b07a8717ee13e55abb6bdd810ea9c321c9a32ee837b&quot;, // Buyer's ephemeral pubkey
  &quot;content&quot;: &quot;sealed-rumor-content&quot;,
  &quot;tags&quot;: [
    [&quot;p&quot;, &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;] // Mostro's pubkey
  ],
  &quot;created_at&quot;: 1234567890,
  &quot;sig&quot;: &quot;a21eb195fe418613aa9a3a8a78039b090e50dc3f9fb06b0f3fe41c63221adc073a9317a1f28d9db843a43c28d860ba173b70132ca85b0e706f6487d43a57ee82&quot;
}
</code></pre>
<h2 id="confirmation-message-3"><a class="header" href="#confirmation-message-3">Confirmation message</a></h2>
<p>Mostro will send back a nip59 event as a confirmation message to the user like the following:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;new-order&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
        &quot;kind&quot;: &quot;buy&quot;,
        &quot;status&quot;: &quot;pending&quot;,
        &quot;amount&quot;: 0,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;fiat_amount&quot;: 100,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;master_buyer_pubkey&quot;: null,
        &quot;master_seller_pubkey&quot;: null,
        &quot;buyer_invoice&quot;: &quot;mostro_p2p@ln.tips&quot;,
        &quot;created_at&quot;: 1698870173
      }
    }
  }
}
</code></pre>
<p>Mostro publishes this order as an event kind <code>38383</code> with status <code>pending</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;84fad0d29cb3529d789faeff2033e88fe157a48e071c6a5d1619928289420e31&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702548701,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;buy&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;pending&quot;],
      [&quot;amt&quot;, &quot;0&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;7e8fe1eb644f33ff51d8805c02a0e1a6d034e6234eac50ef7a7e0dac68a0414f7910366204fa8217086f90eddaa37ded71e61f736d1838e37c0b73f6a16c4af2&quot;
  }
]
</code></pre>
<p>After a seller takes this order Mostro will not ask for an invoice to the buyer, Mostro will get the buyer's invoice and paid it when the seller releases the funds.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="listing-orders"><a class="header" href="#listing-orders">Listing Orders</a></h1>
<p>Mostro publishes new orders with event kind <code>38383</code> and status <code>pending</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;84fad0d29cb3529d789faeff2033e88fe157a48e071c6a5d1619928289420e31&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702548701,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;pending&quot;],
      [&quot;amt&quot;, &quot;0&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;7e8fe1eb644f33ff51d8805c02a0e1a6d034e6234eac50ef7a7e0dac68a0414f7910366204fa8217086f90eddaa37ded71e61f736d1838e37c0b73f6a16c4af2&quot;
  }
]
</code></pre>
<p>Clients can query this events by nostr event kind <code>38383</code>, nostr event author, order status (<code>s</code>), order kind (<code>k</code>), order currency (<code>f</code>), type (<code>z</code>)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="taking-a-sell-order"><a class="header" href="#taking-a-sell-order">Taking a sell order</a></h1>
<p>If the order amount is <code>0</code> the buyer don't know the exact amount to create the invoice, buyer will send a message in a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;take-sell&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>The event to send to Mostro would look like this:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;cade205b849a872d74ba4d2a978135dbc05b4e5f483bb4403c42627dfd24f67d&quot;,
  &quot;kind&quot;: 1059,
  &quot;pubkey&quot;: &quot;9a42ac72d6466a6dbe5b4b07a8717ee13e55abb6bdd810ea9c321c9a32ee837b&quot;,
  &quot;content&quot;: &quot;sealed-rumor-content&quot;,
  &quot;tags&quot;: [
    [&quot;p&quot;, &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;]
  ],
  &quot;created_at&quot;: 1234567890,
  &quot;sig&quot;: &quot;a21eb195fe418613aa9a3a8a78039b090e50dc3f9fb06b0f3fe41c63221adc073a9317a1f28d9db843a43c28d860ba173b70132ca85b0e706f6487d43a57ee82&quot;
}
</code></pre>
<h2 id="mostro-response"><a class="header" href="#mostro-response">Mostro response</a></h2>
<p>In order to continue the buyer needs to send a lightning network invoice to Mostro, in this case the amount of the order is <code>0</code>, so Mostro will need to calculate the amount of sats for this order, then Mostro will send back a message asking for a LN invoice indicating the correct amount of sats that the invoice should have, here the rumor's content of the message:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;add-invoice&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
        &quot;amount&quot;: 7851,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;fiat_amount&quot;: 100,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;buyer_pubkey&quot;: null,
        &quot;seller_pubkey&quot;: null
      }
    }
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>waiting-buyer-invoice</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;waiting-buyer-invoice&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<h2 id="buyer-sends-ln-invoice"><a class="header" href="#buyer-sends-ln-invoice">Buyer sends LN invoice</a></h2>
<p>The buyer sends a Gift wrap Nostr event to Mostro with the lightning invoice, the action should be the same the buyer just received in the last message from Mostro (<code>add-invoice</code>), here the rumor's content of the event for an invoice with no amount:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;add-invoice&quot;,
    &quot;content&quot;: {
      &quot;payment_request&quot;: [
        null,
        &quot;lnbcrt1pn9dvx0pp5935mskms2uf8wx90m8dlr60ytwn5vxy0e65ls42h7y7exweyvekqdqqcqzzsxqyz5vqsp5xjmllv4ta7jkuc5nfgqp8qjc3amzfewmlycpkkggr7q2y5mjfldq9qyyssqncpf3vm8hwujutqc99f0vy45zh8es54mn6u99q9t6rwm0q80dxszskzrp24y46lxqkc7ly9p80t6lalc8x8xhsn49yhy70a7wqyygugpv7chqs&quot;,
        3922
      ]
    }
  }
}
</code></pre>
<p>If the invoice includes an amount, the last element of the <code>payment_request</code> array should be set to <code>null</code>.</p>
<h2 id="mostro-response-1"><a class="header" href="#mostro-response-1">Mostro response</a></h2>
<p>Mostro send a Gift wrap Nostr event to the buyer with a wrapped <code>order</code> in the rumor's content, it would look like this:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;waiting-seller-to-pay&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>waiting-payment</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;waiting-payment&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="taking-a-sell-order-with-a-lightning-address"><a class="header" href="#taking-a-sell-order-with-a-lightning-address">Taking a sell order with a lightning address</a></h1>
<p>The buyer can use a <a href="https://github.com/andrerfneves/lightning-address">lightning address</a> to receive funds and avoid to manually create and send lightning invoices on each trade, to acomplish this the buyer will send a message in a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;take-sell&quot;,
    &quot;content&quot;: {
      &quot;payment_request&quot;: [null, &quot;mostro_p2p@ln.tips&quot;]
    }
  }
}
</code></pre>
<p>The event to send to Mostro would look like this:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;cade205b849a872d74ba4d2a978135dbc05b4e5f483bb4403c42627dfd24f67d&quot;,
  &quot;kind&quot;: 1059,
  &quot;pubkey&quot;: &quot;9a42ac72d6466a6dbe5b4b07a8717ee13e55abb6bdd810ea9c321c9a32ee837b&quot;,
  &quot;content&quot;: &quot;sealed-rumor-content&quot;,
  &quot;tags&quot;: [
    [&quot;p&quot;, &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;]
  ],
  &quot;created_at&quot;: 1234567890,
  &quot;sig&quot;: &quot;a21eb195fe418613aa9a3a8a78039b090e50dc3f9fb06b0f3fe41c63221adc073a9317a1f28d9db843a43c28d860ba173b70132ca85b0e706f6487d43a57ee82&quot;
}
</code></pre>
<h2 id="mostro-response-2"><a class="header" href="#mostro-response-2">Mostro response</a></h2>
<p>Mostro send a Gift wrap Nostr event to the buyer with a wrapped <code>order</code> in the rumor's content, it would look like this:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;waiting-seller-to-pay&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>waiting-payment</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;waiting-payment&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="taking-a-sell-range-order"><a class="header" href="#taking-a-sell-range-order">Taking a sell range order</a></h1>
<p>If the order fiat amount is a range like <code>10-20</code> the buyer must indicate a fiat amount to take the order, buyer will send a message in a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;take-sell&quot;,
    &quot;content&quot;: {
      &quot;amount&quot;: 15
    }
  }
}
</code></pre>
<h2 id="mostro-response-3"><a class="header" href="#mostro-response-3">Mostro response</a></h2>
<p>In order to continue the buyer needs to send a lightning network invoice to Mostro, in this case the amount of the order is <code>0</code>, so Mostro will need to calculate the amount of sats for this order, then Mostro will send back a message asking for a LN invoice indicating the correct amount of sats that the invoice should have, here the rumor's content of the message:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;add-invoice&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
        &quot;amount&quot;: 7851,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;min_amount&quot;: 10,
        &quot;max_amount&quot;: 20,
        &quot;fiat_amount&quot;: 15,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;master_buyer_pubkey&quot;: null,
        &quot;master_seller_pubkey&quot;: null,
        &quot;buyer_invoice&quot;: null,
        &quot;created_at&quot;: null,
        &quot;expires_at&quot;: null
      }
    }
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>waiting-buyer-invoice</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;waiting-buyer-invoice&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;15&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<h2 id="using-a-lightning-address"><a class="header" href="#using-a-lightning-address">Using a lightning address</a></h2>
<p>The buyer can use a <a href="https://github.com/andrerfneves/lightning-address">lightning address</a> to receive funds and avoid to create and send lightning invoices on each trade, with a range order we set the fiat amount as the third element of the <code>payment_request</code> array, to acomplish this the buyer will send a message in a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;take-sell&quot;,
    &quot;content&quot;: {
      &quot;payment_request&quot;: [null, &quot;mostro_p2p@ln.tips&quot;, 15]
    }
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="taking-a-buy-order"><a class="header" href="#taking-a-buy-order">Taking a buy order</a></h1>
<p>To take an order the seller will send to Mostro a message with the following rumor's content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;take-buy&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>The event to send to Mostro would look like this:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;cade205b849a872d74ba4d2a978135dbc05b4e5f483bb4403c42627dfd24f67d&quot;,
  &quot;kind&quot;: 4,
  &quot;pubkey&quot;: &quot;1f5bb148a25bca31506594722e746b10acf2641a12725b12072dcbc46ade544d&quot;, // Seller's ephemeral pubkey
  &quot;content&quot;: &quot;sealed-rumor-content&quot;,
  &quot;tags&quot;: [
    [&quot;p&quot;, &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;] // Mostro's pubkey
  ],
  &quot;created_at&quot;: 1234567890,
  &quot;sig&quot;: &quot;a21eb195fe418613aa9a3a8a78039b090e50dc3f9fb06b0f3fe41c63221adc073a9317a1f28d9db843a43c28d860ba173b70132ca85b0e706f6487d43a57ee82&quot;
}
</code></pre>
<h2 id="mostro-response-4"><a class="header" href="#mostro-response-4">Mostro response</a></h2>
<p>Mostro respond to the seller with a message with the following content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;pubkey&quot;: null,
    &quot;action&quot;: &quot;pay-invoice&quot;,
    &quot;content&quot;: {
      &quot;payment_request&quot;: [
        {
          &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
          &quot;kind&quot;: &quot;buy&quot;,
          &quot;status&quot;: &quot;waiting-payment&quot;,
          &quot;amount&quot;: 7851,
          &quot;fiat_code&quot;: &quot;VES&quot;,
          &quot;fiat_amount&quot;: 100,
          &quot;payment_method&quot;: &quot;face to face&quot;,
          &quot;premium&quot;: 1,
          &quot;created_at&quot;: 1698957793
        },
        &quot;lnbcrt78510n1pj59wmepp50677g8tffdqa2p8882y0x6newny5vtz0hjuyngdwv226nanv4uzsdqqcqzzsxqyz5vqsp5skn973360gp4yhlpmefwvul5hs58lkkl3u3ujvt57elmp4zugp4q9qyyssqw4nzlr72w28k4waycf27qvgzc9sp79sqlw83j56txltz4va44j7jda23ydcujj9y5k6k0rn5ms84w8wmcmcyk5g3mhpqepf7envhdccp72nz6e&quot;
      ]
    }
  }
}
</code></pre>
<p>Mostro updates the event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>WaitingPayment</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;waiting-payment&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<p>And send a message to the buyer with the following content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;pubkey&quot;: null,
    &quot;action&quot;: &quot;waiting-seller-to-pay&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<h2 id="seller-pays-ln-invoice"><a class="header" href="#seller-pays-ln-invoice">Seller pays LN invoice</a></h2>
<p>After seller pays the hold invoice Mostro send a message to the seller with the following content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;pubkey&quot;: null,
    &quot;action&quot;: &quot;waiting-buyer-invoice&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>waiting-buyer-invoice</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;waiting-buyer-invoice&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<p>And sends a message to the buyer with the following content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;pubkey&quot;: null,
    &quot;action&quot;: &quot;add-invoice&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
        &quot;status&quot;: &quot;waiting-buyer-invoice&quot;,
        &quot;amount&quot;: 7851,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;fiat_amount&quot;: 100,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;created_at&quot;: null
      }
    }
  }
}
</code></pre>
<h2 id="buyer-sends-ln-invoice-1"><a class="header" href="#buyer-sends-ln-invoice-1">Buyer sends LN invoice</a></h2>
<p>Buyer sends the LN invoice to Mostro.</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;pubkey&quot;: null,
    &quot;action&quot;: &quot;add-invoice&quot;,
    &quot;content&quot;: {
      &quot;payment_request&quot;: [
        null,
        &quot;lnbcrt78510n1pj59wmepp50677g8tffdqa2p8882y0x6newny5vtz0hjuyngdwv226nanv4uzsdqqcqzzsxqyz5vqsp5skn973360gp4yhlpmefwvul5hs58lkkl3u3ujvt57elmp4zugp4q9qyyssqw4nzlr72w28k4waycf27qvgzc9sp79sqlw83j56txltz4va44j7jda23ydcujj9y5k6k0rn5ms84w8wmcmcyk5g3mhpqepf7envhdccp72nz6e&quot;
      ]
    }
  }
}
</code></pre>
<p>Now both parties have an <code>active</code> order and they can keep going with the trade.</p>
<p>Finally Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>active</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;active&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="taking-a-buy-range-order"><a class="header" href="#taking-a-buy-range-order">Taking a buy range order</a></h1>
<p>If the order fiat amount is a range like <code>10-20</code> the seller must indicate a fiat amount to take the order, seller will send a message in a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;take-buy&quot;,
    &quot;content&quot;: {
      &quot;amount&quot;: 15
    }
  }
}
</code></pre>
<h2 id="mostro-response-5"><a class="header" href="#mostro-response-5">Mostro response</a></h2>
<p>Response is the same as we explained in the <a href="./take_buy.html">Taking a buy order</a> section.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="seller-pays-hold-invoice"><a class="header" href="#seller-pays-hold-invoice">Seller pays hold invoice</a></h1>
<p>When the seller is the maker and the order was taken by a buyer, Mostro will send to the seller a message asking to pay the hold invoice, the rumor's content of the message will look like this:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;pay-invoice&quot;,
    &quot;content&quot;: {
      &quot;payment_request&quot;: [
        {
          &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
          &quot;kind&quot;: &quot;sell&quot;,
          &quot;status&quot;: &quot;waiting-payment&quot;,
          &quot;amount&quot;: 7851,
          &quot;fiat_code&quot;: &quot;VES&quot;,
          &quot;fiat_amount&quot;: 100,
          &quot;payment_method&quot;: &quot;face to face&quot;,
          &quot;premium&quot;: 1,
          &quot;created_at&quot;: 1698937797
        },
        &quot;lnbcrt78510n1pj59wmepp50677g8tffdqa2p8882y0x6newny5vtz0hjuyngdwv226nanv4uzsdqqcqzzsxqyz5vqsp5skn973360gp4yhlpmefwvul5hs58lkkl3u3ujvt57elmp4zugp4q9qyyssqw4nzlr72w28k4waycf27qvgzc9sp79sqlw83j56txltz4va44j7jda23ydcujj9y5k6k0rn5ms84w8wmcmcyk5g3mhpqepf7envhdccp72nz6e&quot;
      ]
    }
  }
}
</code></pre>
<p>After the hold invoice is paid and the buyer already sent the invoice to receive the sats, Mostro will send a new message to seller with the following rumor's content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;buyer-took-order&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
        &quot;kind&quot;: &quot;sell&quot;,
        &quot;status&quot;: &quot;active&quot;,
        &quot;amount&quot;: 7851,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;fiat_amount&quot;: 100,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;master_buyer_pubkey&quot;: &quot;0000147e939bef2b81c27af4c1b702c90c3843f7212a34934bff1e049b7f1427&quot;,
        &quot;master_seller_pubkey&quot;: &quot;00000ba40c5795451705bb9c165b3af93c846894d3062a9cd7fcba090eb3bf78&quot;,
        &quot;buyer_invoice&quot;: null,
        &quot;created_at&quot;: 1698937797
      }
    }
  }
}
</code></pre>
<p>Mostro also send a message to the buyer, this way they can both write to each other in private, this message would look like this:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;pubkey&quot;: null,
    &quot;action&quot;: &quot;hold-invoice-payment-accepted&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
        &quot;kind&quot;: &quot;sell&quot;,
        &quot;status&quot;: &quot;active&quot;,
        &quot;amount&quot;: 7851,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;fiat_amount&quot;: 100,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;master_buyer_pubkey&quot;: &quot;0000147e939bef2b81c27af4c1b702c90c3843f7212a34934bff1e049b7f1427&quot;,
        &quot;master_seller_pubkey&quot;: &quot;00000ba40c5795451705bb9c165b3af93c846894d3062a9cd7fcba090eb3bf78&quot;,
        &quot;buyer_invoice&quot;: null,
        &quot;created_at&quot;: 1698937797
      }
    }
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>active</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;active&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<h2 id="if-the-buyer-didnt-sent-the-invoice-yet"><a class="header" href="#if-the-buyer-didnt-sent-the-invoice-yet">If the buyer didn't sent the invoice yet</a></h2>
<p>Mostro send this message to the seller:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;waiting-buyer-invoice&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>And this message to the buyer:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;add-invoice&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
        &quot;kind&quot;: &quot;sell&quot;,
        &quot;status&quot;: &quot;waiting-buyer-invoice&quot;,
        &quot;amount&quot;: 7851,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;fiat_amount&quot;: 100,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;created_at&quot;: 1698937797
      }
    }
  }
}
</code></pre>
<p>And updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>waiting-buyer-invoice</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;waiting-buyer-invoice&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<p>Now buyer sends the invoice to Mostro:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;pubkey&quot;: null,
    &quot;action&quot;: &quot;add-invoice&quot;,
    &quot;content&quot;: {
      &quot;payment_request&quot;: [
        null,
        &quot;lnbcrt78510n1pj59wmepp50677g8tffdqa2p8882y0x6newny5vtz0hjuyngdwv226nanv4uzsdqqcqzzsxqyz5vqsp5skn973360gp4yhlpmefwvul5hs58lkkl3u3ujvt57elmp4zugp4q9qyyssqw4nzlr72w28k4waycf27qvgzc9sp79sqlw83j56txltz4va44j7jda23ydcujj9y5k6k0rn5ms84w8wmcmcyk5g3mhpqepf7envhdccp72nz6e&quot;
      ]
    }
  }
}
</code></pre>
<p>And both parties receives each other pubkeys to start a direct conversation</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fiat-sent"><a class="header" href="#fiat-sent">Fiat sent</a></h1>
<p>After the buyer sends the fiat money to the seller, the buyer should send a message in a Gift wrap Nostr event to Mostro indicating that the fiat money was sent, the rumor's content would look like this:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;fiat-sent&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>The event to send to Mostro would look like this:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;cade205b849a872d74ba4d2a978135dbc05b4e5f483bb4403c42627dfd24f67d&quot;,
  &quot;kind&quot;: 1059,
  &quot;pubkey&quot;: &quot;9a42ac72d6466a6dbe5b4b07a8717ee13e55abb6bdd810ea9c321c9a32ee837b&quot;,
  &quot;content&quot;: &quot;sealed-rumor-content&quot;,
  &quot;tags&quot;: [
    [&quot;p&quot;, &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;]
  ],
  &quot;created_at&quot;: 1234567890,
  &quot;sig&quot;: &quot;a21eb195fe418613aa9a3a8a78039b090e50dc3f9fb06b0f3fe41c63221adc073a9317a1f28d9db843a43c28d860ba173b70132ca85b0e706f6487d43a57ee82&quot;
}
</code></pre>
<h2 id="mostro-response-6"><a class="header" href="#mostro-response-6">Mostro response</a></h2>
<p>Mostro send messages to both parties confirming <code>fiat-sent</code> action and sending again the counterpart pubkey, here an example of the message to the buyer:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;fiat-sent-ok&quot;,
    &quot;content&quot;: {
      &quot;Peer&quot;: {
        &quot;pubkey&quot;: &quot;00000ba40c5795451705bb9c165b3af93c846894d3062a9cd7fcba090eb3bf78&quot;
      }
    }
  }
}
</code></pre>
<p>And here an example of the message from Mostro to the seller:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;pubkey&quot;: &quot;00000ba40c5795451705bb9c165b3af93c846894d3062a9cd7fcba090eb3bf78&quot;,
    &quot;action&quot;: &quot;fiat-sent-ok&quot;,
    &quot;content&quot;: {
      &quot;Peer&quot;: {
        &quot;pubkey&quot;: &quot;0000147e939bef2b81c27af4c1b702c90c3843f7212a34934bff1e049b7f1427&quot;
      }
    }
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>fiat-sent</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;fiat-sent&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release"><a class="header" href="#release">release</a></h1>
<p>After confirming the buyer sent the fiat money, the seller should send a message to Mostro indicating that sats should be delivered to the buyer, the rumor's content of the message will look like this:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;release&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<h2 id="mostro-response-7"><a class="header" href="#mostro-response-7">Mostro response</a></h2>
<p>Here an example of the Mostro response to the seller:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;hold-invoice-payment-settled&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>And a message to the buyer to let him know that the sats were released:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;released&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<h2 id="buyer-receives-sats"><a class="header" href="#buyer-receives-sats">Buyer receives sats</a></h2>
<p>Right after seller release sats Mostro will try to pay the buyer's lightning invoice, if the payment is successful Mostro will send a message to the buyer indicating that the purchase was completed:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;purchase-completed&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>settled-hold-invoice</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;settled-hold-invoice&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<p>Mostro will then attempt to pay the buyer's invoice, if the payment successds Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>success</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;success&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="user-rating"><a class="header" href="#user-rating">User rating</a></h1>
<p>After a successful trade Mostro send a Gift wrap Nostr event to both parties to let them know they can rate each other, here an example how the message look like:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;7e44aa5d-855a-4b17-865e-8ca3834a91a3&quot;,
    &quot;action&quot;: &quot;rate&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>After a Mostro client receive this message, the user can rate the other party, the rating is a number between 1 and 5, to rate the client must receive user's input and create a new Gift wrap Nostr event to send to Mostro with this content:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;7e44aa5d-855a-4b17-865e-8ca3834a91a3&quot;,
    &quot;action&quot;: &quot;rate-user&quot;,
    &quot;content&quot;: {
      &quot;rating_user&quot;: 5 // User input
    }
  }
}
</code></pre>
<h2 id="confirmation-message-4"><a class="header" href="#confirmation-message-4">Confirmation message</a></h2>
<p>If Mostro received the correct message, it will send back a confirmation message to the user with the action <code>rate-received</code>:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;7e44aa5d-855a-4b17-865e-8ca3834a91a3&quot;,
    &quot;pubkey&quot;: null,
    &quot;action&quot;: &quot;rate-received&quot;,
    &quot;content&quot;: {
      &quot;rating_user&quot;: 5
    }
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable rating event, in this event the <code>d</code> tag will be the user pubkey <code>00000ba40c5795451705bb9c165b3af93c846894d3062a9cd7fcba090eb3bf78</code> and looks like this:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;80909a120d17632f99995f92caff4801f25e9e523d7643bf8acb0166bd0932a6&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702637077,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;00000ba40c5795451705bb9c165b3af93c846894d3062a9cd7fcba090eb3bf78&quot;],
      [&quot;total_reviews&quot;, &quot;1&quot;],
      [&quot;total_rating&quot;, &quot;2&quot;],
      [&quot;last_rating&quot;, &quot;1&quot;],
      [&quot;max_rate&quot;, &quot;2&quot;],
      [&quot;min_rate&quot;, &quot;5&quot;],
      [&quot;data_label&quot;, &quot;rating&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;456fdc0589a5ffe1b55d5474cef2826bf01f458d63cf409490def9c5af31052e0461d38aed4f386f5dcea999e9fe6001d27d592dbba54a0420687dce0652322f&quot;
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cancel-order"><a class="header" href="#cancel-order">Cancel Order</a></h1>
<p>A user can cancel an order created by himself and with status <code>pending</code> sending action <code>cancel</code>, the rumor's content of the message will look like this:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;cancel&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<h2 id="mostro-response-8"><a class="header" href="#mostro-response-8">Mostro response</a></h2>
<p>Mostro will send a message with action <code>cancel</code> confirming the order was canceled, here an example of rumor's content of the message:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;canceled&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>canceled</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;canceled&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<h2 id="cancel-cooperatively"><a class="header" href="#cancel-cooperatively">Cancel cooperatively</a></h2>
<p>A user can cancel an <code>active</code> order, but will need the counterparty to agree, let's look at an example where the seller initiates a cooperative cancellation:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;cancel&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>Mostro will send this message to the seller:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;cooperative-cancel-initiated-by-you&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>And this message to the buyer:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;cooperative-cancel-initiated-by-peer&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>cooperatively-canceled</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;eb0582360ebd3836c90711f774fbecb27e600f4a5fedf4fc2d16fc852f8380b1&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702549437,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;cooperatively-canceled&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;a835f8620db3ebdd9fa142ae99c599a61da86321c60f7c9fed0cc57169950f4121757ff64a5e998baccf6b68272aa51819c3e688d8ad586c0177b3cd1ab09c0f&quot;
  }
]
</code></pre>
<p>The buyer can accept the cooperative cancellation sending this message:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;cancel&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>And Mostro will send this message to both parties:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;cooperative-cancel-accepted&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dispute"><a class="header" href="#dispute">Dispute</a></h1>
<p>A use can start a dispute in an order with status <code>active</code> or <code>fiat-sent</code> sending action <code>dispute</code>, here is an example where the seller initiates a dispute:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;dispute&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<h2 id="mostro-response-9"><a class="header" href="#mostro-response-9">Mostro response</a></h2>
<p>Mostro will send this message to the seller:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;dispute-initiated-by-you&quot;,
    &quot;content&quot;: {
      &quot;dispute&quot;: &quot;efc75871-2568-40b9-a6ee-c382d4d6de01&quot;
    }
  }
}
</code></pre>
<p>And here is the message to the buyer:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;dispute-initiated-by-peer&quot;,
    &quot;content&quot;: {
      &quot;dispute&quot;: &quot;efc75871-2568-40b9-a6ee-c382d4d6de01&quot;
    }
  }
}
</code></pre>
<p>Mostro will not update the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>dispute</code>, this is because the order is still active, the dispute is just a way to let the admins and the other party know that there is a problem with the order.</p>
<h2 id="mostro-send-a-parameterized-replaceable-event-to-show-the-dispute"><a class="header" href="#mostro-send-a-parameterized-replaceable-event-to-show-the-dispute">Mostro send a parameterized replaceable event to show the dispute</a></h2>
<p>Here is an example of the event sent by Mostro:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;4a4d63698f8a27d7d44e5669224acf6af2516a9350ae5f07d3cb91e5601f7302&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1703016565,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;efc75871-2568-40b9-a6ee-c382d4d6de01&quot;],
      [&quot;s&quot;, &quot;initiated&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;dispute&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;00a1da45c00684c5af18cf292ca11697c9e70f2a691e6cd397211e717d2f54362dd401d7567da8184a5c596f48a09693479e67214c23e773523a63d0b1c3f537&quot;
  }
]
</code></pre>
<p>Mostro admin will see the dispute and can take it using the dispute <code>Id</code> from <code>d</code> tag, in this case <code>efc75871-2568-40b9-a6ee-c382d4d6de01</code>.</p>
<pre><code class="language-json">{
  &quot;dispute&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;efc75871-2568-40b9-a6ee-c382d4d6de01&quot;,
    &quot;action&quot;: &quot;admin-take-dispute&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<p>Mostro will send a confirmation message to the admin with the order details:</p>
<pre><code class="language-json">{
  &quot;dispute&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;efc75871-2568-40b9-a6ee-c382d4d6de01&quot;,
    &quot;action&quot;: &quot;admin-took-dispute&quot;,
    &quot;content&quot;: {
      &quot;order&quot;: {
        &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
        &quot;kind&quot;: &quot;sell&quot;,
        &quot;status&quot;: &quot;active&quot;,
        &quot;amount&quot;: 7851,
        &quot;fiat_code&quot;: &quot;VES&quot;,
        &quot;fiat_amount&quot;: 100,
        &quot;payment_method&quot;: &quot;face to face&quot;,
        &quot;premium&quot;: 1,
        &quot;master_buyer_pubkey&quot;: &quot;0000147e939bef2b81c27af4c1b702c90c3843f7212a34934bff1e049b7f1427&quot;,
        &quot;master_seller_pubkey&quot;: &quot;00000ba40c5795451705bb9c165b3af93c846894d3062a9cd7fcba090eb3bf78&quot;,
        &quot;buyer_invoice&quot;: &quot;lnbcrt11020n1pjcypj3pp58m3d9gcu4cc8l3jgkpfn7zhqv2jfw7p3t6z3tq2nmk9cjqam2c3sdqqcqzzsxqyz5vqsp5mew44wzjs0a58d9sfpkrdpyrytswna6gftlfrv8xghkc6fexu6sq9qyyssqnwfkqdxm66lxjv8z68ysaf0fmm50ztvv773jzuyf8a5tat3lnhks6468ngpv3lk5m7yr7vsg97jh6artva5qhd95vafqhxupyuawmrcqnthl9y&quot;,
        &quot;created_at&quot;: 1698870173
      }
    }
  }
}
</code></pre>
<p>Also Mostro will broadcast a new parameterized replaceable dispute event to update the dispute <code>status</code> to <code>in-progress</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;2bb3f5a045bcc1eb057fd1e22c0cece7c58428a6ab5153299ef4e1e89633fde9&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1703020540,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;efc75871-2568-40b9-a6ee-c382d4d6de01&quot;],
      [&quot;s&quot;, &quot;in-progress&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;dispute&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;20d454a0704cfac1d4a6660d234ce407deb56db8f08598741af5d38c0698a96234fd326a34e7efb2ac20c1c0ed0a921fd50513aab8f5c4b83e2509f2d32794d2&quot;
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="listing-disputes"><a class="header" href="#listing-disputes">Listing Disputes</a></h1>
<p>Mostro publishes new disputes with event kind <code>38383</code> and status <code>initiated</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;4a4d63698f8a27d7d44e5669224acf6af2516a9350ae5f07d3cb91e5601f7302&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1703016565,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;efc75871-2568-40b9-a6ee-c382d4d6de01&quot;],
      [&quot;s&quot;, &quot;initiated&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;dispute&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;00a1da45c00684c5af18cf292ca11697c9e70f2a691e6cd397211e717d2f54362dd401d7567da8184a5c596f48a09693479e67214c23e773523a63d0b1c3f537&quot;
  }
]

Clients can query this events by nostr event kind `38383`, nostr event author, dispute status (`s`), type (`z`)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="settle-order"><a class="header" href="#settle-order">Settle order</a></h1>
<p>An admin can settle an order, most of the time this is done when admin is solving a dispute, for this the admin will need to send an <code>order</code> message to Mostro with action <code>admin-settle</code> with the <code>id</code> of the order like this:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;admin-settle&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<h2 id="mostro-response-10"><a class="header" href="#mostro-response-10">Mostro response</a></h2>
<p>Mostro will send this message to the both parties buyer/seller and to the admin:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;admin-settled&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<h2 id="mostro-updates-parameterized-replaceable-events"><a class="header" href="#mostro-updates-parameterized-replaceable-events">Mostro updates parameterized replaceable events</a></h2>
<p>Mostro will publish two parameterized replaceable messages, one for the order to update the status to <code>settled-by-admin</code>, this means that the hold invoice paid by the seller was settled:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;3d74ce3f10096d163603aa82beb5778bd1686226fdfcfba5d4c3a2c3137929ea&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1703260182,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;settled-by-admin&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;76bfc5e9ce089757dd4074472e1df421da700ce133c874f40b1136607121eca8acfdd2b8b4b374adaa83fa0c7d99672eb21a1068b6b6b774742d5de5bfc932ba&quot;
  }
]
</code></pre>
<p>And updates parameterized replaceable dispute event with status <code>settled</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;098e8622eae022a79bc793984fccbc5ea3f6641bdcdffaa031c00d3bd33ca5a0&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1703274022,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;efc75871-2568-40b9-a6ee-c382d4d6de01&quot;],
      [&quot;s&quot;, &quot;settled&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;dispute&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;6d7ca7bef7b696f1f6f8cfc33b3fe1beb2fdc6b7647efc93be669c6c1a9d4bafc770d9b0d25432c204dd487d48b39e589dfd7b03bf0e808483921b8937bd5367&quot;
  }
]
</code></pre>
<h2 id="payment-of-the-buyers-invoice"><a class="header" href="#payment-of-the-buyers-invoice">Payment of the buyer's invoice</a></h2>
<p>At this point Mostro is trying to pay the buyer's invoice, right after complete the payment Mostro will update the status of the order parameterized replaceable event to <code>success</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;6170892aca6a73906142e58a9c29734d49b399a3811f6216ce553b4a77a8a11e&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1703274032,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;success&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;1670a9e61f7bc99f7121a95a2d479456970fbd9bc84d663160e35d1a95d71a006c7986db050ea584d5040927879fd9dcc85dc0ab5c6367f679c9fd5fd33a3cfb&quot;
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cancel-order-1"><a class="header" href="#cancel-order-1">Cancel order</a></h1>
<p>An admin can cancel an order, most of the time this is done when admin is solving a dispute, for this the admin will need to send an <code>order</code> message to Mostro with action <code>admin-cancel</code> with the <code>id</code> of the order like this:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;admin-cancel&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<h2 id="mostro-response-11"><a class="header" href="#mostro-response-11">Mostro response</a></h2>
<p>Mostro will send this message to the both parties buyer/seller and to the admin:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;id&quot;: &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;,
    &quot;action&quot;: &quot;admin-canceled&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<h2 id="mostro-updates-parameterized-replaceable-events-1"><a class="header" href="#mostro-updates-parameterized-replaceable-events-1">Mostro updates parameterized replaceable events</a></h2>
<p>Mostro will publish two parameterized replaceable events, one for the order to update the status to <code>canceled-by-admin</code>, this means that the hold invoice was canceled and the seller's funds were returned:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;3d74ce3f10096d163603aa82beb5778bd1686226fdfcfba5d4c3a2c3137929ea&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1703260182,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;canceled-by-admin&quot;],
      [&quot;amt&quot;, &quot;7851&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;76bfc5e9ce089757dd4074472e1df421da700ce133c874f40b1136607121eca8acfdd2b8b4b374adaa83fa0c7d99672eb21a1068b6b6b774742d5de5bfc932ba&quot;
  }
]
</code></pre>
<p>And updates parameterized replaceable dispute event with status <code>seller-refunded</code>:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;098e8622eae022a79bc793984fccbc5ea3f6641bdcdffaa031c00d3bd33ca5a0&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1703274022,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;efc75871-2568-40b9-a6ee-c382d4d6de01&quot;],
      [&quot;s&quot;, &quot;seller-refunded&quot;],
      [&quot;y&quot;, &quot;mostrop2p&quot;],
      [&quot;z&quot;, &quot;dispute&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;6d7ca7bef7b696f1f6f8cfc33b3fe1beb2fdc6b7647efc93be669c6c1a9d4bafc770d9b0d25432c204dd487d48b39e589dfd7b03bf0e808483921b8937bd5367&quot;
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="admin-add-solver"><a class="header" href="#admin-add-solver">Admin add solver</a></h1>
<p>Solvers are users appointed by the Mostro administrator and are responsible for resolving disputes.</p>
<p>The administrator can add or remove them at any time.</p>
<p>The administrator can also solve disputes.</p>
<p>To add a solver the admin will need to send an <code>order</code> message to Mostro with action <code>admin-add-solver</code>:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;action&quot;: &quot;admin-add-solver&quot;,
    &quot;content&quot;: {
      &quot;text_message&quot;: &quot;npub1qqq884wtp2jn96lqhqlnarl4kk3rmvrc9z2nmrvqujx3m4l2ea5qd5d0fq&quot;
    }
  }
}
</code></pre>
<h2 id="mostro-response-12"><a class="header" href="#mostro-response-12">Mostro response</a></h2>
<p>Mostro will send this message to the admin:</p>
<pre><code class="language-json">{
  &quot;order&quot;: {
    &quot;version&quot;: 1,
    &quot;action&quot;: &quot;admin-add-solver&quot;,
    &quot;content&quot;: null
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="actions"><a class="header" href="#actions">Actions</a></h1>
<h2 id="mostro_coreaction"><a class="header" href="#mostro_coreaction">mostro_core::Action</a></h2>
<p>Action is used to identify each message between Mostro and users</p>
<p>You can see details in <a href="https://docs.rs/mostro-core/latest/mostro_core/message/enum.Action.html">mostro core documentation</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="message-suggestions-for-some-actions"><a class="header" href="#message-suggestions-for-some-actions">Message suggestions for some actions</a></h1>
<p>Here are suggestions for messages that clients could show to users when they receive certain actions. Clients can customize these messages to their convenience, as well as translate them, add emojis or any other modifications they consider necessary to provide a good user experience. Clients must complete the information that is in <code>monospace</code> format.</p>
<ul>
<li>
<p><strong>new-order:</strong> Your offer has been published! Please wait until another user picks your order. It will be available for <code>expiration_hours</code> hours. You can cancel this order before another user picks it up by executing: <code>cancel</code>.</p>
</li>
<li>
<p><strong>canceled:</strong> You have cancelled the order ID: <code>id</code>!</p>
</li>
<li>
<p><strong>pay-invoice:</strong> Please pay this hold invoice of <code>amount</code> Sats for <code>fiat_code</code> <code>fiat_amount</code> to start the operation. If you do not pay it within <code>expiration_seconds</code> the trade will be cancelled.</p>
</li>
<li>
<p><strong>add-invoice:</strong> Please send me an invoice for <code>amount</code> satoshis equivalent to  <code>fiat_code</code> <code>fiat_amount</code>.  This is where Ill send the funds upon completion of the trade. If you don't provide the invoice within <code>expiration_seconds</code> this trade will be cancelled.</p>
</li>
<li>
<p><strong>waiting-seller-to-pay:</strong> Please wait a bit. I've sent a payment request to the seller to sends the Sats for the order ID <code>id</code>. Once the payment is made, I'll connect you both. If the seller doesnt complete the payment within <code>expiration_seconds</code> minutes the trade will be cancelled.</p>
</li>
<li>
<p><strong>waiting-buyer-invoice:</strong> Payment received! Your Sats are now &quot;held&quot; in your own wallet. Please wait a bit. I've requested the buyer to provide an invoice. Once they do, I 'll connect you both. If they does not do so within <code>expiration_seconds</code> your Sats will be available at your wallet again and the trade will be cancelled.</p>
</li>
<li>
<p><strong>buyer-invoice-accepted:</strong> Invoice has been successfully saved!</p>
</li>
<li>
<p><strong>hold-invoice-payment-accepted:</strong> Get in touch with the seller, this is their npub <code>seller-npub</code> to get the details on how to send the fiat money for the order <code>id</code>, you must send <code>fiat_code</code> <code>fiat_amount</code> using <code>payment_method</code>. Once you send the fiat money, please let me know with <code>fiat-sent</code>.</p>
</li>
<li>
<p><strong>buyer-took-order:</strong> Get in touch with the buyer, this is their npub <code>buyer-npub</code> to inform them how to send you <code>fiat_code</code> <code>fiat_amount</code> through <code>payment_method</code>. I will notify you once the buyer indicates the fiat money has been sent. Afterward, you should verify if it has arrived. If the buyer does not respond, you can initiate a cancellation or a dispute. Remember, an administrator will NEVER contact you to resolve your order unless you open a dispute first.</p>
</li>
<li>
<p><strong>fiat-sent-ok:</strong></p>
<ul>
<li><em>To the buyer</em>:  I have informed to <code>seller-npub</code> that you have sent the fiat money. When the seller confirms they have received your fiat money, they should release the funds. If they refuse, you can open a dispute.</li>
<li><em>To the seller</em>: <code>buyer-npub</code> has informed that they have sent you the fiat money. Once you confirm receipt, please release the funds. After releasing, the money will go to the buyer and there will be no turning back, so only proceed if you are sure. If you want to release the Sats to the buyer, send me <code>release-order-message</code>.</li>
</ul>
</li>
<li>
<p><strong>released:</strong> <code>seller-npub</code> has already released the Sats! Expect your invoice to be paid any time. Remember your wallet needs to be online to receive through the Lightning Network.</p>
</li>
<li>
<p><strong>purchase-completed:</strong> Your satoshis purchase has been completed successfully. I have paid your invoice, enjoy sound money!</p>
</li>
<li>
<p><strong>hold-invoice-payment-settled:</strong> Your Sats sale has been completed after confirming the payment from <code>buyer-npub</code>.</p>
</li>
<li>
<p><strong>rate:</strong> Please qualify your counterparty </p>
</li>
<li>
<p><strong>rate-received:</strong> Rating successfully saved!</p>
</li>
<li>
<p><strong>cooperative-cancel-initiated-by-you:</strong> You have initiated the cancellation of the order ID: <code>id</code>. Your counterparty must agree to the cancellation too. If they do not respond, you can open a dispute. Note that no administrator will contact you regarding this cancellation unless you open a dispute first.</p>
</li>
<li>
<p><strong>cooperative-cancel-initiated-by-peer:</strong> Your counterparty wants to cancel order ID: <code>id</code>. Note that no administrator will contact you regarding this cancellation unless you open a dispute first. If you agree on such cancellation, please send me <code>cancel-order-message</code>.</p>
</li>
<li>
<p><strong>cooperative-cancel-accepted:</strong> Order <code>id</code> has been successfully cancelled!</p>
</li>
<li>
<p><strong>dispute-initiated-by-you:</strong> You have initiated a dispute for order Id: <code>id</code>.  A solver will be assigned to your dispute soon. Once assigned, I will share their npub with you, and only they will be able to assist you. You may contact the solver directly, but if they reach out first, please ask them to provide the token for your dispute. Your dispute token is: <code>user-token</code>.</p>
</li>
<li>
<p><strong>dispute-initiated-by-peer:</strong> Your counterparty has initiated a dispute for order Id: <code>${orderId}.</code> A solver will be assigned to your dispute soon. Once assigned, I will share their npub with you, and only they will be able to assist you. You may contact the solver directly, but if they reach out first, please ask them to provide the token for your dispute. Your dispute token is: <code>user-token</code>.</p>
</li>
<li>
<p><strong>admin-took-dispute:</strong> </p>
<ul>
<li><em>To the admin</em>: Here are the details of the dispute order you have taken: <code>details</code>. You need to determine which user is correct and decide whether to cancel or complete the order. Please note that your decision will be final and cannot be reversed.</li>
<li><em>To the users</em>: The solver <code>admin-npub</code> will handle your dispute.  You can contact them directly, but if they reach out to you first, make sure to ask them for your dispute token.</li>
</ul>
</li>
<li>
<p><strong>admin-canceled:</strong></p>
<ul>
<li><em>To the admin</em>: You have cancelled the order ID: <code>id</code>!</li>
<li><em>To the users</em>: Admin has cancelled the order ID: <code>id</code>!</li>
</ul>
</li>
<li>
<p><strong>admin-settled:</strong> </p>
<ul>
<li><em>To the admin</em>: You have completed the order ID: <code>id</code>!</li>
<li><em>To the users</em>: Admin has completed the order ID: <code>id</code>!</li>
</ul>
</li>
<li>
<p><strong>is-not-your-dispute:</strong> This dispute was not assigned to you! </p>
</li>
<li>
<p><strong>not-found:</strong> Dispute not found. </p>
</li>
<li>
<p><strong>payment-failed:</strong> I tried to send you the Sats but the payment of your invoice failed, I will try <code>payment_attempts</code> more times in <code>payment_retries_interval</code> minutes window. Please ensure your node/wallet is online.</p>
</li>
<li>
<p><strong>invoice-updated:</strong> Invoice has been successfully updated!</p>
</li>
<li>
<p><strong>hold-invoice-payment-canceled:</strong> The invoice was cancelled, your Sats will be available at your wallet again.</p>
</li>
<li>
<p><strong>cant-do:</strong> You are not allowed to <code>action</code> for this order!</p>
</li>
<li>
<p><strong>admin-add-solver:</strong> You have successfully added to the solver <code>npub</code>.</p>
</li>
<li>
<p><strong>is-not-your-order:</strong> You did not create this order and are not authorized to <code>action</code> it.</p>
</li>
<li>
<p><strong>not-allowed-by-status:</strong> You are not allowed to <code>action</code> because order Id <code>id</code> status is <code>order-status</code>.</p>
</li>
<li>
<p><strong>out-of-range-fiat-amount:</strong> The requested amount is incorrect and may be outside the acceptable range. The minimum is  <code>min_amount</code> and the maximum is <code>max_amount</code>.</p>
</li>
<li>
<p><strong>incorrect-invoice-amount:</strong> </p>
<ul>
<li><em>If the buyer previously had sent the <code>new-order</code> action</em>:<br />
An invoice with non-zero amount was receive for the new order. Please send an invoice with a zero amount or no invoice at all.</li>
<li><em>If the buyer previously sent the <code>add-invoice</code> action</em>:<br />
The amount stated in the invoice is incorrect. Please send an invoice with an amount of <code>amount</code> satoshis, an invoice without an amount, or a lightning address.</li>
</ul>
</li>
<li>
<p><strong>invalid-sats-amount:</strong> That specified Sats amount is invalid.</p>
</li>
<li>
<p><strong>out-of-range-sats-amount:</strong> The allowed Sats amount for this Mostro is between min <code>min_order_amount</code> and max <code>max_order_amount</code>. Please enter an amount within this range.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="peer-to-peer-order-events"><a class="header" href="#peer-to-peer-order-events">Peer-to-peer Order events</a></h1>
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>Peer-to-peer (P2P) platforms have seen an upturn in recent years, while having more and more options is positive, in the specific case of p2p, having several options contributes to the liquidity split, meaning sometimes there's not enough assets available for trading. If we combine all these individual solutions into one big pool of orders, it will make them much more competitive compared to centralized systems, where a single authority controls the liquidity.</p>
<p>This NIP defines a simple standard for peer-to-peer order events, which enables the creation of a big liquidity pool for all p2p platforms participating.</p>
<h2 id="the-event"><a class="header" href="#the-event">The event</a></h2>
<p>Events are <a href="https://github.com/nostr-protocol/nips/blob/master/01.md#kinds">Parameterized Replaceable Events</a> and use <code>38383</code> as event kind, a p2p event look like this:</p>
<pre><code class="language-json">[
  &quot;EVENT&quot;,
  &quot;RAND&quot;,
  {
    &quot;id&quot;: &quot;84fad0d29cb3529d789faeff2033e88fe157a48e071c6a5d1619928289420e31&quot;,
    &quot;pubkey&quot;: &quot;dbe0b1be7aafd3cfba92d7463edbd4e33b2969f61bd554d37ac56f032e13355a&quot;,
    &quot;created_at&quot;: 1702548701,
    &quot;kind&quot;: 38383,
    &quot;tags&quot;: [
      [&quot;d&quot;, &quot;ede61c96-4c13-4519-bf3a-dcf7f1e9d842&quot;],
      [&quot;k&quot;, &quot;sell&quot;],
      [&quot;f&quot;, &quot;VES&quot;],
      [&quot;s&quot;, &quot;pending&quot;],
      [&quot;amt&quot;, &quot;0&quot;],
      [&quot;fa&quot;, &quot;100&quot;],
      [&quot;pm&quot;, &quot;face to face&quot;, &quot;bank transfer&quot;],
      [&quot;premium&quot;, &quot;1&quot;],
      [
        &quot;rating&quot;,
        &quot;{\&quot;total_reviews\&quot;:1,\&quot;total_rating\&quot;:3.0,\&quot;last_rating\&quot;:3,\&quot;max_rate\&quot;:5,\&quot;min_rate\&quot;:1}&quot;
      ],
      [&quot;source&quot;, &quot;https://t.me/p2plightning/xxxxxxx&quot;],
      [&quot;network&quot;, &quot;mainnet&quot;],
      [&quot;layer&quot;, &quot;lightning&quot;],
      [&quot;name&quot;, &quot;Satoshi&quot;],
      [&quot;g&quot;, &quot;&lt;geohash&gt;&quot;],
      [&quot;bond&quot;, &quot;0&quot;],
      [&quot;expiration&quot;, &quot;1719391096&quot;],
      [&quot;y&quot;, &quot;lnp2pbot&quot;],
      [&quot;z&quot;, &quot;order&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;7e8fe1eb644f33ff51d8805c02a0e1a6d034e6234eac50ef7a7e0dac68a0414f7910366204fa8217086f90eddaa37ded71e61f736d1838e37c0b73f6a16c4af2&quot;
  }
]
</code></pre>
<h2 id="tags"><a class="header" href="#tags">Tags</a></h2>
<ul>
<li><code>d</code> &lt; Order ID &gt;: A unique identifier for the order.</li>
<li><code>k</code> &lt; Order type &gt;: <code>sell</code> or <code>buy</code>.</li>
<li><code>f</code> &lt; Currency &gt;: The asset being traded, using the <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO 4217</a> standard.</li>
<li><code>s</code> &lt; Status &gt;: <code>pending</code>, <code>canceled</code>, <code>in-progress</code>, <code>success</code>.</li>
<li><code>amt</code> &lt; Amount &gt;: The amount of Bitcoin to be traded, the amount is defined in satoshis, if <code>0</code> means that the amount of satoshis will be obtained from a public API after the taker accepts the order.</li>
<li><code>fa</code> &lt; Fiat amount &gt;: The fiat amount being traded, for range orders two values are expected, the minimum and maximum amount.</li>
<li><code>pm</code> &lt; Payment method &gt;: The payment method used for the trade, if the order has multiple payment methods, they should be separated by a comma.</li>
<li><code>premium</code> &lt; Premium &gt;: The percentage of the premium the maker is willing to pay.</li>
<li><code>source</code> [Source]: The source of the order, it can be a URL that redirects to the order.</li>
<li><code>rating</code> [Rating]: The rating of the maker, this document does not define how the rating is calculated, it's up to the platform to define it.</li>
<li><code>network</code> &lt; Network &gt;: The network used for the trade, it can be <code>mainnet</code>, <code>testnet</code>, <code>signet</code>, etc.</li>
<li><code>layer</code> &lt; Layer &gt;: The layer used for the trade, it can be <code>onchain</code>, <code>lightning</code>, <code>liquid</code>, etc.</li>
<li><code>name</code> [Name]: The name of the maker.</li>
<li><code>g</code> [Geohash]: The geohash of the operation, it can be useful in a face to face trade.</li>
<li><code>bond</code> [Bond]: The bond amount, the bond is a security deposit that both parties must pay.</li>
<li><code>expiration</code> &lt; Expiration&gt;: The expiration date of the order (<a href="https://github.com/nostr-protocol/nips/blob/master/40.md">NIP-40</a>).</li>
<li><code>y</code> &lt; Platform &gt;: The platform that created the order.</li>
<li><code>z</code> &lt; Document &gt;: <code>order</code>.</li>
</ul>
<p>Mandatory tags are enclosed with <code>&lt;tag&gt;</code>, optional tags are enclosed with <code>[tag]</code>.</p>
<h2 id="implementations"><a class="header" href="#implementations">Implementations</a></h2>
<p>Currently implemented on the following platforms:</p>
<ul>
<li><a href="https://github.com/MostroP2P/mostro">Mostro</a></li>
<li><a href="https://github.com/lnp2pBot/bot">@lnp2pBot</a></li>
</ul>
<h2 id="this-document-is-inspired-on"><a class="header" href="#this-document-is-inspired-on">This document is inspired on</a></h2>
<ul>
<li><a href="https://mostro.network/messages/">Mostro messages specification</a></li>
<li><a href="https://github.com/nostr-protocol/nips/blob/8250274a22f4882f621510df0054fd6167c10c9e/31001.md">Messages specification for peer 2 peer NIP proposal</a></li>
<li><a href="https://github.com/nobu-maeda/n3xb">n3xB</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
