<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Mostro protocol</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="overview.html">Home</a></li><li class="chapter-item expanded "><a href="key_management.html"><strong aria-hidden="true">1.</strong> Key management</a></li><li class="chapter-item expanded "><a href="new_sell_order.html"><strong aria-hidden="true">2.</strong> Creating a Sell order</a></li><li class="chapter-item expanded "><a href="new_sell_range_order.html"><strong aria-hidden="true">3.</strong> Creating a Sell range order</a></li><li class="chapter-item expanded "><a href="new_buy_order.html"><strong aria-hidden="true">4.</strong> Creating a Buy order</a></li><li class="chapter-item expanded "><a href="new_buy_order_ln_address.html"><strong aria-hidden="true">5.</strong> Creating a Buy order with a LN address</a></li><li class="chapter-item expanded "><a href="list_orders.html"><strong aria-hidden="true">6.</strong> List orders</a></li><li class="chapter-item expanded "><a href="take_sell.html"><strong aria-hidden="true">7.</strong> Take sell order</a></li><li class="chapter-item expanded "><a href="take_sell_ln_address.html"><strong aria-hidden="true">8.</strong> Take sell order with a LN address</a></li><li class="chapter-item expanded "><a href="take_sell_range_order.html"><strong aria-hidden="true">9.</strong> Take range sell order</a></li><li class="chapter-item expanded "><a href="take_buy.html"><strong aria-hidden="true">10.</strong> Take buy order</a></li><li class="chapter-item expanded "><a href="take_buy_range_order.html"><strong aria-hidden="true">11.</strong> Take range buy order</a></li><li class="chapter-item expanded "><a href="seller_pay_hold_invoice.html"><strong aria-hidden="true">12.</strong> Seller pays hold invoice</a></li><li class="chapter-item expanded "><a href="fiatsent.html"><strong aria-hidden="true">13.</strong> Fiat sent</a></li><li class="chapter-item expanded "><a href="release.html"><strong aria-hidden="true">14.</strong> Release</a></li><li class="chapter-item expanded "><a href="user_rating.html"><strong aria-hidden="true">15.</strong> Rate user</a></li><li class="chapter-item expanded "><a href="cancel.html"><strong aria-hidden="true">16.</strong> Cancel</a></li><li class="chapter-item expanded "><a href="dispute.html"><strong aria-hidden="true">17.</strong> Dispute</a></li><li class="chapter-item expanded "><a href="list_disputes.html"><strong aria-hidden="true">18.</strong> List disputes</a></li><li class="chapter-item expanded "><a href="admin_settle_order.html"><strong aria-hidden="true">19.</strong> Admin Settle order</a></li><li class="chapter-item expanded "><a href="admin_cancel_order.html"><strong aria-hidden="true">20.</strong> Admin Cancel order</a></li><li class="chapter-item expanded "><a href="admin_add_solver.html"><strong aria-hidden="true">21.</strong> Admin Add Solver</a></li><li class="chapter-item expanded "><a href="actions.html"><strong aria-hidden="true">22.</strong> Actions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="message_suggestions_for_actions.html"><strong aria-hidden="true">22.1.</strong> Message suggestions for actions</a></li></ol></li><li class="chapter-item expanded "><a href="order-event.html"><strong aria-hidden="true">23.</strong> P2P Order event. NIP-69</a></li><li class="chapter-item expanded "><a href="other_events.html"><strong aria-hidden="true">24.</strong> Other events published by Mostro</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Mostro protocol</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>In order to have a shared order's book, Mostro daemon send <a href="https://github.com/nostr-protocol/nips/blob/master/01.md#kinds">Addressable Events</a> with <code>38383</code> as event <code>kind</code>, you can find more details about that specific event <a href="./order-event.html">here</a></p>
<h2 id="communication-between-users-and-mostro"><a class="header" href="#communication-between-users-and-mostro">Communication between users and Mostro</a></h2>
<p>All messages from/to Mostro should be <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">Gift wrap Nostr events</a>, the <code>content</code> of the <code>rumor</code> event should be a nip44 encrypted JSON-serialized string (with no white space or line breaks) of the following structure:</p>
<ul>
<li><a href="https://docs.rs/mostro-core/latest/mostro_core/message/enum.Message.html">Wrapper</a>: Wrapper of the message
<ul>
<li><code>version</code>: Version of the protocol, currently <code>1</code></li>
<li><code>id</code>: (optional) Wrapper Id</li>
<li><code>require_id</code>: (optional) Mostro daemon should send back this same id in the response</li>
<li><code>trade_index</code>: (optional) This field is used by users who wants to maintain reputation, it should be the index of the trade in the user's trade history</li>
<li><a href="https://docs.rs/mostro-core/latest/mostro_core/message/enum.Action.html">action</a>: Action to be performed by Mostro daemon</li>
<li><a href="https://docs.rs/mostro-core/latest/mostro_core/message/enum.Content.html">payload</a> (optional): Payload of the message, this field is optional and depends on the action</li>
</ul>
</li>
</ul>
<p>These fields are relative to the wrapper, here an example of a <code>fiat-sent</code> Order message, in this case <code>id</code> is the Order Id:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "require_id": "12345",
    "trade_index": 1,
    "action": "fiat-sent",
    "payload": null
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="key-management"><a class="header" href="#key-management">Key management</a></h1>
<p><em>It is required to read <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">NIP-59 (gift wrap)</a> and <a href="https://github.com/nostr-protocol/nips/blob/master/06.md">NIP-06</a> to fully understand this document</em></p>
<p>Mostro clients should implement nip59 which creates newly fresh keys on each message to Mostro, but the key management is a bit more complex, here we will explain how to manage keys in Mostro clients.</p>
<h3 id="objectives"><a class="header" href="#objectives">Objectives:</a></h3>
<ul>
<li>Facilitate portability by using a deterministic key generation mechanism based on NIP-06.</li>
<li>Prevent users from mistakenly entering key material already used in other Nostr social media apps.</li>
<li>Rotate keys for every trade.</li>
</ul>
<p>When a user started a Mostro client for first time, the client should create a new mnemonic seed phrase which is the only information users will need to share with other client to have the same <code>Mostro session</code>. Mostro clients should use the derivation path <code>m/44'/1237'/38383'/0/0</code>.</p>
<p>Clients will always use the first key (zero) <code>m/44'/1237'/38383'/0/0</code> to identify itself with mostrod, users who wants to maintain reputation can send an event to Mostro signed with the <code>zero</code> key, the identity key, used to update their rating, for every new order created or taken the client will start deriving new keys from <code>m/44'/1237'/38383'/0/1</code>, users who don't want to maintain reputation simply don't send the identity key to mostrod, let's see it in more detail with an example:</p>
<ul>
<li>
<p>Alice starts a Mostro client for first time, at that moment the client creates a new mnemonic seed phrase and derive two keys, the identity key (index <code>0</code>) and the next trade key with index <code>1</code> <code>m/44'/1237'/38383'/0/1</code>, we will use identiy key to sign the gift wrap seal event and the trade key to sign the first element of the content of the rumor event.</p>
</li>
<li>
<p>Alice wants to buy some bitcoin and take a sell order, the client send a message in a Gift wrap Nostr event to mostrod with the seal signed with index <code>0</code> key and in the rumor we should demostrate we own the trade key (index <code>1</code>), let's see a <code>take-sell</code> example in an unencrypted gift wrap event:</p>
</li>
</ul>
<pre><code class="language-json">// external wrap layer
{
  "id": "&lt;id&gt;",
  "kind": 1059,
  "pubkey": "&lt;Buyer's ephemeral pubkey&gt;",
  "content": {
    // seal
    "id": "&lt;seal's id&gt;",
    "pubkey": "&lt;index 0 pubkey (identity key)&gt;",
    "content": {
      // rumor
      "id": "&lt;rumor's id&gt;",
      "pubkey": "&lt;Index 1 pubkey&gt;",
      "kind": 1,
      "content": [
        {
          "order": {
            "version": 1,
            "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
            "trade_index": 1,
            "action": "take-sell",
            "payload": null
          }
        },
        "&lt;index 1 signature of the sha256 hash of the serialized first element of content&gt;"
      ],
      "created_at": 1691518405,
      "tags": []
    },
    "kind": 13,
    "created_at": 1686840217,
    "tags": [],
    "sig": "&lt;index 0 pubkey (identity key) signature&gt;"
  },
  "tags": [["p", "&lt;Mostro's pubkey&gt;"]],
  "created_at": 1234567890,
  "sig": "&lt;Buyer's ephemeral pubkey signature&gt;"
}
</code></pre>
<ul>
<li>After finish the deal the <a href="./user_rating.html">rate</a> each other.</li>
</ul>
<p>Then Alice wants to create a new buy order:</p>
<ul>
<li>The client derives the next key, new key is index <code>2</code> (<code>m/44'/1237'/38383'/0/2</code>) and send a message in a Gift wrap Nostr event to mostrod with the seal signed with index <code>0</code> key, but let's see the complete example with a full unencrypted gift wrap:</li>
</ul>
<pre><code class="language-json">// external wrap layer
{
  "id": "&lt;id&gt;",
  "kind": 1059,
  "pubkey": "&lt;Buyer's ephemeral pubkey&gt;",
  "content": {
    // seal
    "id": "&lt;seal's id&gt;",
    "pubkey": "&lt;index 0 pubkey (identity key)&gt;",
    "content": {
      // rumor
      "id": "&lt;rumor's id&gt;",
      "pubkey": "&lt;Index 2 pubkey&gt;",
      "kind": 1,
      "content": [
        {
          "order": {
            "version": 1,
            "trade_index": 2,
            "action": "new-order",
            "payload": {
              "order": {
                "kind": "buy",
                "status": "pending",
                "amount": 0,
                "fiat_code": "VES",
                "fiat_amount": 100,
                "payment_method": "face to face",
                "premium": 1,
                "created_at": 1691518405
              }
            }
          }
        },
        "&lt;index 2 signature of the sha256 hash of the serialized first element of content&gt;"
      ],
      "created_at": 1691518405,
      "tags": []
    },
    "kind": 13,
    "created_at": 1686840217,
    "tags": [],
    "sig": "&lt;index 0 pubkey (identity key) signature&gt;"
  },
  "tags": [["p", "&lt;Mostro's pubkey&gt;"]],
  "created_at": 1234567890,
  "sig": "&lt;Buyer's ephemeral pubkey signature&gt;"
}
</code></pre>
<p>Now Alice waits for some seller to take her order, mostrod will show Alice's reputation but not Alice pubkey.</p>
<h3 id="full-privacy-mode"><a class="header" href="#full-privacy-mode">Full privacy mode</a></h3>
<p>Clients must offer a more private version where the client never send the identity key to mostrod, in that case mostrod can't link orders to users, the tradeoff is that users who choose this option cannot have a reputation, let's see a <code>take-sell</code> example in an unencrypted gift wrap event:</p>
<pre><code class="language-json">// external wrap layer
{
  "id": "&lt;id&gt;",
  "kind": 1059,
  "pubkey": "&lt;Buyer's ephemeral pubkey&gt;",
  "content": {
    // seal
    "id": "&lt;seal's id&gt;",
    "pubkey": "&lt;index N pubkey (trade key)&gt;",
    "content": {
      // rumor
      "id": "&lt;rumor's id&gt;",
      "pubkey": "&lt;index N pubkey (trade key)&gt;",
      "kind": 1,
      "content": [
        {
          "order": {
            "version": 1,
            "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
            // "trade_index": 1, // not needed
            "action": "take-sell",
            "payload": null
          }
        },
        null
      ],
      "created_at": 1691518405,
      "tags": []
    },
    "kind": 13,
    "created_at": 1686840217,
    "tags": [],
    "sig": "&lt;index N pubkey (trade key) signature&gt;"
  },
  "tags": [["p", "&lt;Mostro's pubkey&gt;"]],
  "created_at": 1234567890,
  "sig": "&lt;Buyer's ephemeral pubkey signature&gt;"
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-a-new-sell-order"><a class="header" href="#creating-a-new-sell-order">Creating a new sell order</a></h1>
<p>To create a new sell order the user should send a Gift wrap Nostr event to Mostro, the rumor event should have the following rumor's content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "action": "new-order",
    "payload": {
      "order": {
        "kind": "sell",
        "status": "pending",
        "amount": 0,
        "fiat_code": "VES",
        "min_amount": null,
        "max_amount": null,
        "fiat_amount": 100,
        "payment_method": "face to face",
        "premium": 1,
        "created_at": 0
      }
    }
  }
}
</code></pre>
<p>Let's explain some of the fields:</p>
<ul>
<li>kind: <code>sell</code> or <code>buy</code></li>
<li>status: Is always <code>pending</code> when creating a new order</li>
<li>amount: 0 for when we want to sell with at market price, otherwise the amount in satoshis</li>
<li>created_at: No need to send the correct unix timestamp, Mostro will replace it with the current time</li>
</ul>
<p>The event to send to Mostro would look like this:</p>
<pre><code class="language-json">{
  "id": "&lt;Event id&gt;",
  "kind": 1059,
  "pubkey": "&lt;Seller's ephemeral pubkey&gt;",
  "content": "&lt;sealed-rumor-content&gt;",
  "tags": [["p", "Mostro's pubkey"]],
  "created_at": 1234567890,
  "sig": "&lt;Signature of ephemeral pubkey&gt;"
}
</code></pre>
<h2 id="confirmation-message"><a class="header" href="#confirmation-message">Confirmation message</a></h2>
<p>Mostro will send back a nip59 event as a confirmation message to the user like the following (unencrypted rumor's content example):</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "new-order",
    "payload": {
      "order": {
        "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
        "kind": "sell",
        "status": "pending",
        "amount": 0,
        "fiat_code": "VES",
        "fiat_amount": 100,
        "payment_method": "face to face",
        "premium": 1,
        "created_at": 1698870173
      }
    }
  }
}
</code></pre>
<p>Mostro publishes this order as an event kind <code>38383</code> with status <code>pending</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702548701,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "pending"],
      ["amt", "0"],
      ["fa", "100"],
      ["pm", "face to face", "bank transfer"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-a-new-sell-range-order"><a class="header" href="#creating-a-new-sell-range-order">Creating a new sell range order</a></h1>
<p>To create a new range order the user should send a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "action": "new-order",
    "payload": {
      "order": {
        "kind": "sell",
        "status": "pending",
        "amount": 0,
        "fiat_code": "VES",
        "min_amount": 10,
        "max_amount": 20,
        "fiat_amount": 0,
        "payment_method": "face to face",
        "premium": 1,
        "created_at": 0
      }
    }
  }
}
</code></pre>
<p>Here we have two new fields, <code>min_amount</code> and <code>max_amount</code>, to define the range of the order. The <code>fiat_amount</code> field is set to 0 to indicate that the order is for a range of amounts.</p>
<p>When a taker takes the order, the amount will be set on the message.</p>
<h2 id="confirmation-message-1"><a class="header" href="#confirmation-message-1">Confirmation message</a></h2>
<p>Mostro will send back a nip59 event as a confirmation message to the user like the following:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "new-order",
    "payload": {
      "order": {
        "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
        "kind": "sell",
        "status": "pending",
        "amount": 0,
        "fiat_code": "VES",
        "min_amount": 10,
        "max_amount": 20,
        "fiat_amount": 0,
        "payment_method": "face to face",
        "premium": 1,
        "created_at": 1698870173
      }
    }
  }
}
</code></pre>
<p>Mostro publishes this order as an event kind <code>38383</code> with status <code>pending</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702548701,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "pending"],
      ["amt", "0"],
      ["fa", "10", "20"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-a-new-buy-order"><a class="header" href="#creating-a-new-buy-order">Creating a new buy order</a></h1>
<p>To create a new buy order the user should send a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "action": "new-order",
    "payload": {
      "order": {
        "kind": "buy",
        "status": "pending",
        "amount": 0,
        "fiat_code": "VES",
        "fiat_amount": 100,
        "payment_method": "face to face",
        "premium": 1,
        "created_at": 0
      }
    }
  }
}
</code></pre>
<p>The nostr event will look like this:</p>
<pre><code class="language-json">{
  "id": "&lt;Event id&gt;",
  "kind": 1059,
  "pubkey": "&lt;Buyer's ephemeral pubkey&gt;",
  "content": "&lt;sealed-rumor-content&gt;",
  "tags": [["p", "Mostro's pubkey"]],
  "created_at": 1234567890,
  "sig": "&lt;Signature of ephemeral pubkey&gt;"
}
</code></pre>
<h2 id="confirmation-message-2"><a class="header" href="#confirmation-message-2">Confirmation message</a></h2>
<p>Mostro will send back a nip59 event as a confirmation message to the user like the following:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "new-order",
    "payload": {
      "order": {
        "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
        "kind": "buy",
        "status": "pending",
        "amount": 0,
        "fiat_code": "VES",
        "fiat_amount": 100,
        "payment_method": "face to face",
        "premium": 1,
        "master_buyer_pubkey": null,
        "master_seller_pubkey": null,
        "buyer_invoice": null,
        "created_at": 1698870173
      }
    }
  }
}
</code></pre>
<p>Mostro publishes this order as an event kind <code>38383</code> with status <code>pending</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702548701,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "buy"],
      ["f", "VES"],
      ["s", "pending"],
      ["amt", "0"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<p>After a seller takes this order Mostro will request an invoice from the buyer, Mostro will pay the buyer's invoice when the seller releases the funds.</p>
<h2 id="creating-the-order-with-a-lightning-invoice"><a class="header" href="#creating-the-order-with-a-lightning-invoice">Creating the order with a lightning invoice</a></h2>
<p>There are two ways where the buyer can create the order adding the invoice:</p>
<ol>
<li>
<p>If the buyer already knows the amount, e.g. buyer wants to buy 15000 sats with 10 euros, in this case the buyer knows from the beginning that the invoice should have amount 15000 - Mostro's fee, instead of the user doing the calculation, the client must do it and in some cases create the invoice with the right amount.</p>
</li>
<li>
<p>If the buyer don't know the amount, e.g. buyer wants to buy sats with 10 euros, in this case the buyer can add an amountless invoice and Mostro will pay it with the market price amount - Mostro's fee automatically.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-a-new-order"><a class="header" href="#creating-a-new-order">Creating a new order</a></h1>
<p>Creating buy order with a <a href="https://github.com/andrerfneves/lightning-address">lightning address</a> would make the process way faster and easy going, to acomplish the buyer should send a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "action": "new-order",
    "payload": {
      "order": {
        "kind": "buy",
        "status": "pending",
        "amount": 0,
        "fiat_code": "VES",
        "fiat_amount": 100,
        "payment_method": "face to face",
        "premium": 1,
        "buyer_invoice": "mostro_p2p@ln.tips",
        "created_at": 0
      }
    }
  }
}
</code></pre>
<p>The nostr event will look like this:</p>
<pre><code class="language-json">{
  "id": "&lt;Event id&gt;",
  "kind": 1059,
  "pubkey": "&lt;Buyer's ephemeral pubkey&gt;",
  "content": "&lt;sealed-rumor-content&gt;",
  "tags": [["p", "Mostro's pubkey"]],
  "created_at": 1234567890,
  "sig": "&lt;Signature of ephemeral pubkey&gt;"
}
</code></pre>
<h2 id="confirmation-message-3"><a class="header" href="#confirmation-message-3">Confirmation message</a></h2>
<p>Mostro will send back a nip59 event as a confirmation message to the user like the following:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "new-order",
    "payload": {
      "order": {
        "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
        "kind": "buy",
        "status": "pending",
        "amount": 0,
        "fiat_code": "VES",
        "fiat_amount": 100,
        "payment_method": "face to face",
        "premium": 1,
        "master_buyer_pubkey": null,
        "master_seller_pubkey": null,
        "buyer_invoice": "mostro_p2p@ln.tips",
        "created_at": 1698870173
      }
    }
  }
}
</code></pre>
<p>Mostro publishes this order as an event kind <code>38383</code> with status <code>pending</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702548701,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "buy"],
      ["f", "VES"],
      ["s", "pending"],
      ["amt", "0"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<p>After a seller takes this order Mostro will not ask for an invoice to the buyer, Mostro will get the buyer's invoice and paid it when the seller releases the funds.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="listing-orders"><a class="header" href="#listing-orders">Listing Orders</a></h1>
<p>Mostro publishes new orders with event kind <code>38383</code> and status <code>pending</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702548701,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "pending"],
      ["amt", "0"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<p>Clients can query this events by nostr event kind <code>38383</code>, nostr event author, order status (<code>s</code>), order kind (<code>k</code>), order currency (<code>f</code>), type (<code>z</code>)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="taking-a-sell-order"><a class="header" href="#taking-a-sell-order">Taking a sell order</a></h1>
<p>If the order amount is <code>0</code> the buyer don't know the exact amount to create the invoice, buyer will send a message in a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "take-sell",
    "payload": null
  }
}
</code></pre>
<p>The event to send to Mostro would look like this:</p>
<pre><code class="language-json">{
  "id": "&lt;Event id&gt;",
  "kind": 1059,
  "pubkey": "&lt;Ephemeral pubkey&gt;",
  "content": "&lt;sealed-rumor-content&gt;",
  "tags": [["p", "Mostro's pubkey"]],
  "created_at": 1234567890,
  "sig": "&lt;Signature of ephemeral pubkey&gt;"
}
</code></pre>
<h2 id="mostro-response"><a class="header" href="#mostro-response">Mostro response</a></h2>
<p>In order to continue the buyer needs to send a lightning network invoice to Mostro, in this case the amount of the order is <code>0</code>, so Mostro will need to calculate the amount of sats for this order, then Mostro will send back a message asking for a LN invoice indicating the correct amount of sats that the invoice should have, here the rumor's content of the message:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "add-invoice",
    "payload": {
      "order": {
        "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
        "amount": 7851,
        "fiat_code": "VES",
        "fiat_amount": 100,
        "payment_method": "face to face",
        "premium": 1,
        "buyer_pubkey": null,
        "seller_pubkey": null
      }
    }
  }
}
</code></pre>
<p>Mostro updates the addressable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>waiting-buyer-invoice</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "waiting-buyer-invoice"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<h2 id="buyer-sends-ln-invoice"><a class="header" href="#buyer-sends-ln-invoice">Buyer sends LN invoice</a></h2>
<p>The buyer sends a Gift wrap Nostr event to Mostro with the lightning invoice, the action should be the same the buyer just received in the last message from Mostro (<code>add-invoice</code>), here the rumor's content of the event for an invoice with no amount:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "add-invoice",
    "payload": {
      "payment_request": [
        null,
        "lnbcrt1pn9dvx0pp5935mskms2uf8wx90m8dlr60ytwn5vxy0e65ls42h7y7exweyvekqdqqcqzzsxqyz5vqsp5xjmllv4ta7jkuc5nfgqp8qjc3amzfewmlycpkkggr7q2y5mjfldq9qyyssqncpf3vm8hwujutqc99f0vy45zh8es54mn6u99q9t6rwm0q80dxszskzrp24y46lxqkc7ly9p80t6lalc8x8xhsn49yhy70a7wqyygugpv7chqs",
        3922
      ]
    }
  }
}
</code></pre>
<p>If the invoice includes an amount, the last element of the <code>payment_request</code> array should be set to <code>null</code>.</p>
<h2 id="mostro-response-1"><a class="header" href="#mostro-response-1">Mostro response</a></h2>
<p>Mostro send a Gift wrap Nostr event to the buyer with a wrapped <code>order</code> in the rumor's content, it would look like this:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "waiting-seller-to-pay",
    "payload": null
  }
}
</code></pre>
<p>Mostro updates the addressable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>waiting-payment</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "waiting-payment"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="taking-a-sell-order-with-a-lightning-address"><a class="header" href="#taking-a-sell-order-with-a-lightning-address">Taking a sell order with a lightning address</a></h1>
<p>The buyer can use a <a href="https://github.com/andrerfneves/lightning-address">lightning address</a> to receive funds and avoid to manually create and send lightning invoices on each trade, to acomplish this the buyer will send a message in a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "take-sell",
    "payload": {
      "payment_request": [null, "mostro_p2p@ln.tips"]
    }
  }
}
</code></pre>
<p>The event to send to Mostro would look like this:</p>
<pre><code class="language-json">{
  "id": "&lt;Event id&gt;",
  "kind": 1059,
  "pubkey": "&lt;Ephemeral pubkey&gt;",
  "content": "&lt;sealed-rumor-content&gt;",
  "tags": [["p", "Mostro's pubkey"]],
  "created_at": 1234567890,
  "sig": "&lt;Signature of ephemeral pubkey&gt;"
}
</code></pre>
<h2 id="mostro-response-2"><a class="header" href="#mostro-response-2">Mostro response</a></h2>
<p>Mostro send a Gift wrap Nostr event to the buyer with a wrapped <code>order</code> in the rumor's content, it would look like this:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "waiting-seller-to-pay",
    "payload": null
  }
}
</code></pre>
<p>Mostro updates the addressable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>waiting-payment</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "waiting-payment"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="taking-a-sell-range-order"><a class="header" href="#taking-a-sell-range-order">Taking a sell range order</a></h1>
<p>If the order fiat amount is a range like <code>10-20</code> the buyer must indicate a fiat amount to take the order, buyer will send a message in a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "take-sell",
    "payload": {
      "amount": 15
    }
  }
}
</code></pre>
<h2 id="mostro-response-3"><a class="header" href="#mostro-response-3">Mostro response</a></h2>
<p>In order to continue the buyer needs to send a lightning network invoice to Mostro, in this case the amount of the order is <code>0</code>, so Mostro will need to calculate the amount of sats for this order, then Mostro will send back a message asking for a LN invoice indicating the correct amount of sats that the invoice should have, here the rumor's content of the message:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "add-invoice",
    "payload": {
      "order": {
        "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
        "amount": 7851,
        "fiat_code": "VES",
        "min_amount": 10,
        "max_amount": 20,
        "fiat_amount": 15,
        "payment_method": "face to face",
        "premium": 1,
        "master_buyer_pubkey": null,
        "master_seller_pubkey": null,
        "buyer_invoice": null,
        "created_at": null,
        "expires_at": null
      }
    }
  }
}
</code></pre>
<p>Mostro updates the addressable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>waiting-buyer-invoice</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "waiting-buyer-invoice"],
      ["amt", "7851"],
      ["fa", "15"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<h2 id="using-a-lightning-address"><a class="header" href="#using-a-lightning-address">Using a lightning address</a></h2>
<p>The buyer can use a <a href="https://github.com/andrerfneves/lightning-address">lightning address</a> to receive funds and avoid to create and send lightning invoices on each trade, with a range order we set the fiat amount as the third element of the <code>payment_request</code> array, to acomplish this the buyer will send a message in a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "take-sell",
    "payload": {
      "payment_request": [null, "mostro_p2p@ln.tips", 15]
    }
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="taking-a-buy-order"><a class="header" href="#taking-a-buy-order">Taking a buy order</a></h1>
<p>To take an order the seller will send to Mostro a message with the following rumor's content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "take-buy",
    "payload": null
  }
}
</code></pre>
<p>The event to send to Mostro would look like this:</p>
<pre><code class="language-json">{
  "id": "&lt;Event id&gt;",
  "kind": 4,
  "pubkey": "&lt;Seller's ephemeral pubkey&gt;",
  "content": "&lt;sealed-rumor-content&gt;",
  "tags": [["p", "Mostro's pubkey"]],
  "created_at": 1234567890,
  "sig": "&lt;Signature of ephemeral pubkey&gt;"
}
</code></pre>
<h2 id="mostro-response-4"><a class="header" href="#mostro-response-4">Mostro response</a></h2>
<p>Mostro respond to the seller with a message with the following content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "pay-invoice",
    "payload": {
      "payment_request": [
        {
          "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
          "kind": "buy",
          "status": "waiting-payment",
          "amount": 7851,
          "fiat_code": "VES",
          "fiat_amount": 100,
          "payment_method": "face to face",
          "premium": 1,
          "created_at": 1698957793
        },
        "lnbcrt78510n1pj59wmepp50677g8tffdqa2p8882y0x6newny5vtz0hjuyngdwv226nanv4uzsdqqcqzzsxqyz5vqsp5skn973360gp4yhlpmefwvul5hs58lkkl3u3ujvt57elmp4zugp4q9qyyssqw4nzlr72w28k4waycf27qvgzc9sp79sqlw83j56txltz4va44j7jda23ydcujj9y5k6k0rn5ms84w8wmcmcyk5g3mhpqepf7envhdccp72nz6e"
      ]
    }
  }
}
</code></pre>
<p>Mostro updates the event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>WaitingPayment</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "waiting-payment"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<p>And send a message to the buyer with the following content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "waiting-seller-to-pay",
    "payload": null
  }
}
</code></pre>
<h2 id="seller-pays-ln-invoice"><a class="header" href="#seller-pays-ln-invoice">Seller pays LN invoice</a></h2>
<p>After seller pays the hold invoice Mostro send a message to the seller with the following content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "waiting-buyer-invoice",
    "payload": null
  }
}
</code></pre>
<p>Mostro updates the addressable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>waiting-buyer-invoice</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "waiting-buyer-invoice"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<p>And sends a message to the buyer with the following content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "add-invoice",
    "payload": {
      "order": {
        "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
        "status": "waiting-buyer-invoice",
        "amount": 7851,
        "fiat_code": "VES",
        "fiat_amount": 100,
        "payment_method": "face to face",
        "premium": 1,
        "created_at": null
      }
    }
  }
}
</code></pre>
<h2 id="buyer-sends-ln-invoice-1"><a class="header" href="#buyer-sends-ln-invoice-1">Buyer sends LN invoice</a></h2>
<p>Buyer sends the LN invoice to Mostro.</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "add-invoice",
    "payload": {
      "payment_request": [
        null,
        "lnbcrt78510n1pj59wmepp50677g8tffdqa2p8882y0x6newny5vtz0hjuyngdwv226nanv4uzsdqqcqzzsxqyz5vqsp5skn973360gp4yhlpmefwvul5hs58lkkl3u3ujvt57elmp4zugp4q9qyyssqw4nzlr72w28k4waycf27qvgzc9sp79sqlw83j56txltz4va44j7jda23ydcujj9y5k6k0rn5ms84w8wmcmcyk5g3mhpqepf7envhdccp72nz6e"
      ]
    }
  }
}
</code></pre>
<p>Now both parties have an <code>active</code> order and they can keep going with the trade.</p>
<p>Finally Mostro updates the addressable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>active</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "active"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="taking-a-buy-range-order"><a class="header" href="#taking-a-buy-range-order">Taking a buy range order</a></h1>
<p>If the order fiat amount is a range like <code>10-20</code> the seller must indicate a fiat amount to take the order, seller will send a message in a Gift wrap Nostr event to Mostro with the following rumor's content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "take-buy",
    "payload": {
      "amount": 15
    }
  }
}
</code></pre>
<h2 id="mostro-response-5"><a class="header" href="#mostro-response-5">Mostro response</a></h2>
<p>Response is the same as we explained in the <a href="./take_buy.html">Taking a buy order</a> section.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="seller-pays-hold-invoice"><a class="header" href="#seller-pays-hold-invoice">Seller pays hold invoice</a></h1>
<p>When the seller is the maker and the order was taken by a buyer, Mostro will send to the seller a message asking to pay the hold invoice, the rumor's content of the message will look like this:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "pay-invoice",
    "payload": {
      "payment_request": [
        {
          "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
          "kind": "sell",
          "status": "waiting-payment",
          "amount": 7851,
          "fiat_code": "VES",
          "fiat_amount": 100,
          "payment_method": "face to face",
          "premium": 1,
          "created_at": 1698937797
        },
        "lnbcrt78510n1pj59wmepp50677g8tffdqa2p8882y0x6newny5vtz0hjuyngdwv226nanv4uzsdqqcqzzsxqyz5vqsp5skn973360gp4yhlpmefwvul5hs58lkkl3u3ujvt57elmp4zugp4q9qyyssqw4nzlr72w28k4waycf27qvgzc9sp79sqlw83j56txltz4va44j7jda23ydcujj9y5k6k0rn5ms84w8wmcmcyk5g3mhpqepf7envhdccp72nz6e"
      ]
    }
  }
}
</code></pre>
<p>After the hold invoice is paid and the buyer already sent the invoice to receive the sats, Mostro will send a new message to seller with the following rumor's content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "buyer-took-order",
    "payload": {
      "order": {
        "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
        "kind": "sell",
        "status": "active",
        "amount": 7851,
        "fiat_code": "VES",
        "fiat_amount": 100,
        "payment_method": "face to face",
        "premium": 1,
        "master_buyer_pubkey": "&lt;Buyer's trade pubkey&gt;",
        "master_seller_pubkey": "&lt;Seller's trade pubkey&gt;",
        "buyer_invoice": null,
        "created_at": 1698937797
      }
    }
  }
}
</code></pre>
<p>Mostro also send a message to the buyer, this way they can both write to each other in private, this message would look like this:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "hold-invoice-payment-accepted",
    "payload": {
      "order": {
        "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
        "kind": "sell",
        "status": "active",
        "amount": 7851,
        "fiat_code": "VES",
        "fiat_amount": 100,
        "payment_method": "face to face",
        "premium": 1,
        "master_buyer_pubkey": "&lt;Buyer's trade pubkey&gt;",
        "master_seller_pubkey": "&lt;Seller's trade pubkey&gt;",
        "buyer_invoice": null,
        "created_at": 1698937797
      }
    }
  }
}
</code></pre>
<p>Mostro updates the addressable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>active</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "active"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<h2 id="if-the-buyer-didnt-sent-the-invoice-yet"><a class="header" href="#if-the-buyer-didnt-sent-the-invoice-yet">If the buyer didn't sent the invoice yet</a></h2>
<p>Mostro send this message to the seller:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "waiting-buyer-invoice",
    "payload": null
  }
}
</code></pre>
<p>And this message to the buyer:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "add-invoice",
    "payload": {
      "order": {
        "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
        "kind": "sell",
        "status": "waiting-buyer-invoice",
        "amount": 7851,
        "fiat_code": "VES",
        "fiat_amount": 100,
        "payment_method": "face to face",
        "premium": 1,
        "created_at": 1698937797
      }
    }
  }
}
</code></pre>
<p>And updates the addressable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>waiting-buyer-invoice</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "waiting-buyer-invoice"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<p>Now buyer sends the invoice to Mostro:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "add-invoice",
    "payload": {
      "payment_request": [
        null,
        "lnbcrt78510n1pj59wmepp50677g8tffdqa2p8882y0x6newny5vtz0hjuyngdwv226nanv4uzsdqqcqzzsxqyz5vqsp5skn973360gp4yhlpmefwvul5hs58lkkl3u3ujvt57elmp4zugp4q9qyyssqw4nzlr72w28k4waycf27qvgzc9sp79sqlw83j56txltz4va44j7jda23ydcujj9y5k6k0rn5ms84w8wmcmcyk5g3mhpqepf7envhdccp72nz6e"
      ]
    }
  }
}
</code></pre>
<p>And both parties receives each other pubkeys to start a direct conversation</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fiat-sent"><a class="header" href="#fiat-sent">Fiat sent</a></h1>
<p>After the buyer sends the fiat money to the seller, the buyer should send a message in a Gift wrap Nostr event to Mostro indicating that the fiat money was sent, the rumor's content would look like this:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "fiat-sent",
    "payload": null
  }
}
</code></pre>
<p>The event to send to Mostro would look like this:</p>
<pre><code class="language-json">{
  "id": "&lt;Event id&gt;",
  "kind": 1059,
  "pubkey": "&lt;Ephemeral pubkey&gt;",
  "content": "&lt;sealed-rumor-content&gt;",
  "tags": [["p", "Mostro's pubkey"]],
  "created_at": 1234567890,
  "sig": "&lt;Signature of ephemeral pubkey&gt;"
}
</code></pre>
<h2 id="mostro-response-6"><a class="header" href="#mostro-response-6">Mostro response</a></h2>
<p>Mostro send messages to both parties confirming <code>fiat-sent</code> action and sending again the counterpart pubkey, here an example of the message to the buyer:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "fiat-sent-ok",
    "payload": {
      "Peer": {
        "pubkey": "&lt;Seller's trade pubkey&gt;"
      }
    }
  }
}
</code></pre>
<p>And here an example of the message from Mostro to the seller:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "pubkey": "&lt;Seller's trade pubkey&gt;",
    "action": "fiat-sent-ok",
    "payload": {
      "Peer": {
        "pubkey": "&lt;Buyer's trade pubkey&gt;"
      }
    }
  }
}
</code></pre>
<p>Mostro updates the addressable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>fiat-sent</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "fiat-sent"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release"><a class="header" href="#release">release</a></h1>
<p>After confirming the buyer sent the fiat money, the seller should send a message to Mostro indicating that sats should be delivered to the buyer, the rumor's content of the message will look like this:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "release",
    "payload": null
  }
}
</code></pre>
<h2 id="mostro-response-7"><a class="header" href="#mostro-response-7">Mostro response</a></h2>
<p>Here an example of the Mostro response to the seller:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "hold-invoice-payment-settled",
    "payload": null
  }
}
</code></pre>
<p>And a message to the buyer to let him know that the sats were released:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "released",
    "payload": null
  }
}
</code></pre>
<h2 id="buyer-receives-sats"><a class="header" href="#buyer-receives-sats">Buyer receives sats</a></h2>
<p>Right after seller release sats Mostro will try to pay the buyer's lightning invoice, if the payment is successful Mostro will send a message to the buyer indicating that the purchase was completed:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "purchase-completed",
    "payload": null
  }
}
</code></pre>
<p>Mostro updates the addressable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>settled-hold-invoice</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "settled-hold-invoice"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<p>Mostro will then attempt to pay the buyer's invoice, if the payment successds Mostro updates the addressable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>success</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "success"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="user-rating"><a class="header" href="#user-rating">User rating</a></h1>
<p>After a successful trade Mostro send a Gift wrap Nostr event to both parties to let them know they can rate each other, here an example how the message look like:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "7e44aa5d-855a-4b17-865e-8ca3834a91a3",
    "action": "rate",
    "payload": null
  }
}
</code></pre>
<p>After a Mostro client receive this message, the user can rate the other party, the rating is a number between 1 and 5, to rate the client must receive user's input and create a new Gift wrap Nostr event to send to Mostro with this content:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "7e44aa5d-855a-4b17-865e-8ca3834a91a3",
    "action": "rate-user",
    "payload": {
      "rating_user": 5 // User input
    }
  }
}
</code></pre>
<h2 id="confirmation-message-4"><a class="header" href="#confirmation-message-4">Confirmation message</a></h2>
<p>If Mostro received the correct message, it will send back a confirmation message to the user with the action <code>rate-received</code>:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "7e44aa5d-855a-4b17-865e-8ca3834a91a3",
    "action": "rate-received",
    "payload": {
      "rating_user": 5
    }
  }
}
</code></pre>
<p>Mostro updates the addressable rating event, in this event the <code>d</code> tag will be the user pubkey <code>&lt;Seller's trade pubkey&gt;</code> and looks like this:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702637077,
    "kind": 38383,
    "tags": [
      ["d", "&lt;Seller's trade pubkey&gt;"],
      ["total_reviews", "1"],
      ["total_rating", "2"],
      ["last_rating", "1"],
      ["max_rate", "2"],
      ["min_rate", "5"],
      ["z", "rating"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cancel-order"><a class="header" href="#cancel-order">Cancel Order</a></h1>
<p>A user can cancel an order created by himself and with status <code>pending</code> sending action <code>cancel</code>, the rumor's content of the message will look like this:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "cancel",
    "payload": null
  }
}
</code></pre>
<h2 id="mostro-response-8"><a class="header" href="#mostro-response-8">Mostro response</a></h2>
<p>Mostro will send a message with action <code>cancel</code> confirming the order was canceled, here an example of rumor's content of the message:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "canceled",
    "payload": null
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>canceled</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "canceled"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["network", "mainnet"],
      ["layer", "lightning"],
      ["expiration", "1719391096"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<h2 id="cancel-cooperatively"><a class="header" href="#cancel-cooperatively">Cancel cooperatively</a></h2>
<p>A user can cancel an <code>active</code> order, but will need the counterparty to agree, let's look at an example where the seller initiates a cooperative cancellation:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "cancel",
    "payload": null
  }
}
</code></pre>
<p>Mostro will send this message to the seller:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "cooperative-cancel-initiated-by-you",
    "payload": null
  }
}
</code></pre>
<p>And this message to the buyer:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "cooperative-cancel-initiated-by-peer",
    "payload": null
  }
}
</code></pre>
<p>Mostro updates the parameterized replaceable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>cooperatively-canceled</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1702549437,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "cooperatively-canceled"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<p>The buyer can accept the cooperative cancellation sending this message:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "cancel",
    "payload": null
  }
}
</code></pre>
<p>And Mostro will send this message to both parties:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "cooperative-cancel-accepted",
    "payload": null
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dispute"><a class="header" href="#dispute">Dispute</a></h1>
<p>A use can start a dispute in an order with status <code>active</code> or <code>fiat-sent</code> sending action <code>dispute</code>, here is an example where the seller initiates a dispute:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "dispute",
    "payload": null
  }
}
</code></pre>
<h2 id="mostro-response-9"><a class="header" href="#mostro-response-9">Mostro response</a></h2>
<p>Mostro will send this message to the seller:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "dispute-initiated-by-you",
    "payload": {
      "dispute": "efc75871-2568-40b9-a6ee-c382d4d6de01"
    }
  }
}
</code></pre>
<p>And here is the message to the buyer:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "dispute-initiated-by-peer",
    "payload": {
      "dispute": "efc75871-2568-40b9-a6ee-c382d4d6de01"
    }
  }
}
</code></pre>
<p>Mostro will not update the addressable event with <code>d</code> tag <code>ede61c96-4c13-4519-bf3a-dcf7f1e9d842</code> to change the status to <code>dispute</code>, this is because the order is still active, the dispute is just a way to let the admins and the other party know that there is a problem with the order.</p>
<h2 id="mostro-send-a-addressable-event-to-show-the-dispute"><a class="header" href="#mostro-send-a-addressable-event-to-show-the-dispute">Mostro send a addressable event to show the dispute</a></h2>
<p>Here is an example of the event sent by Mostro:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1703016565,
    "kind": 38383,
    "tags": [
      ["d", "efc75871-2568-40b9-a6ee-c382d4d6de01"],
      ["s", "initiated"],
      ["y", "mostrop2p"],
      ["z", "dispute"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<p>Mostro admin will see the dispute and can take it using the dispute <code>Id</code> from <code>d</code> tag, in this case <code>efc75871-2568-40b9-a6ee-c382d4d6de01</code>.</p>
<pre><code class="language-json">{
  "dispute": {
    "version": 1,
    "id": "efc75871-2568-40b9-a6ee-c382d4d6de01",
    "action": "admin-take-dispute",
    "payload": null
  }
}
</code></pre>
<p>Mostro will send a confirmation message to the admin with the order details:</p>
<pre><code class="language-json">{
  "dispute": {
    "version": 1,
    "id": "efc75871-2568-40b9-a6ee-c382d4d6de01",
    "action": "admin-took-dispute",
    "payload": {
      "order": {
        "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
        "kind": "sell",
        "status": "active",
        "amount": 7851,
        "fiat_code": "VES",
        "fiat_amount": 100,
        "payment_method": "face to face",
        "premium": 1,
        "master_buyer_pubkey": "&lt;Buyer's trade pubkey&gt;",
        "master_seller_pubkey": "&lt;Seller's trade pubkey&gt;",
        "buyer_invoice": "lnbcrt11020n1pjcypj3pp58m3d9gcu4cc8l3jgkpfn7zhqv2jfw7p3t6z3tq2nmk9cjqam2c3sdqqcqzzsxqyz5vqsp5mew44wzjs0a58d9sfpkrdpyrytswna6gftlfrv8xghkc6fexu6sq9qyyssqnwfkqdxm66lxjv8z68ysaf0fmm50ztvv773jzuyf8a5tat3lnhks6468ngpv3lk5m7yr7vsg97jh6artva5qhd95vafqhxupyuawmrcqnthl9y",
        "created_at": 1698870173
      }
    }
  }
}
</code></pre>
<p>Also Mostro will broadcast a new addressable dispute event to update the dispute <code>status</code> to <code>in-progress</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1703020540,
    "kind": 38383,
    "tags": [
      ["d", "efc75871-2568-40b9-a6ee-c382d4d6de01"],
      ["s", "in-progress"],
      ["y", "mostrop2p"],
      ["z", "dispute"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="listing-disputes"><a class="header" href="#listing-disputes">Listing Disputes</a></h1>
<p>Mostro publishes new disputes with event kind <code>38383</code> and status <code>initiated</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1703016565,
    "kind": 38383,
    "tags": [
      ["d", "efc75871-2568-40b9-a6ee-c382d4d6de01"],
      ["s", "initiated"],
      ["y", "mostrop2p"],
      ["z", "dispute"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<p>Clients can query this events by nostr event kind <code>38383</code>, nostr event author, dispute status (<code>s</code>), type (<code>z</code>)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="settle-order"><a class="header" href="#settle-order">Settle order</a></h1>
<p>An admin can settle an order, most of the time this is done when admin is solving a dispute, for this the admin will need to send an <code>order</code> message to Mostro with action <code>admin-settle</code> with the <code>id</code> of the order like this:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "admin-settle",
    "payload": null
  }
}
</code></pre>
<h2 id="mostro-response-10"><a class="header" href="#mostro-response-10">Mostro response</a></h2>
<p>Mostro will send this message to the both parties buyer/seller and to the admin:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "admin-settled",
    "payload": null
  }
}
</code></pre>
<h2 id="mostro-updates-addressable-events"><a class="header" href="#mostro-updates-addressable-events">Mostro updates addressable events</a></h2>
<p>Mostro will publish two addressable events, one for the order to update the status to <code>settled-by-admin</code>, this means that the hold invoice paid by the seller was settled:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "3d74ce3f10096d163603aa82beb5778bd1686226fdfcfba5d4c3a2c3137929ea",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1703260182,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "settled-by-admin"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<p>And updates addressable dispute event with status <code>settled</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "098e8622eae022a79bc793984fccbc5ea3f6641bdcdffaa031c00d3bd33ca5a0",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1703274022,
    "kind": 38383,
    "tags": [
      ["d", "efc75871-2568-40b9-a6ee-c382d4d6de01"],
      ["s", "settled"],
      ["y", "mostrop2p"],
      ["z", "dispute"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<h2 id="payment-of-the-buyers-invoice"><a class="header" href="#payment-of-the-buyers-invoice">Payment of the buyer's invoice</a></h2>
<p>At this point Mostro is trying to pay the buyer's invoice, right after complete the payment Mostro will update the status of the order addressable event to <code>success</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "6170892aca6a73906142e58a9c29734d49b399a3811f6216ce553b4a77a8a11e",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1703274032,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "success"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cancel-order-1"><a class="header" href="#cancel-order-1">Cancel order</a></h1>
<p>An admin can cancel an order, most of the time this is done when admin is solving a dispute, for this the admin will need to send an <code>order</code> message to Mostro with action <code>admin-cancel</code> with the <code>id</code> of the order like this:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "admin-cancel",
    "payload": null
  }
}
</code></pre>
<h2 id="mostro-response-11"><a class="header" href="#mostro-response-11">Mostro response</a></h2>
<p>Mostro will send this message to the both parties buyer/seller and to the admin:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "id": "ede61c96-4c13-4519-bf3a-dcf7f1e9d842",
    "action": "admin-canceled",
    "payload": null
  }
}
</code></pre>
<h2 id="mostro-updates-addressable-events-1"><a class="header" href="#mostro-updates-addressable-events-1">Mostro updates addressable events</a></h2>
<p>Mostro will publish two addressable events, one for the order to update the status to <code>canceled-by-admin</code>, this means that the hold invoice was canceled and the seller's funds were returned:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "3d74ce3f10096d163603aa82beb5778bd1686226fdfcfba5d4c3a2c3137929ea",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1703260182,
    "kind": 38383,
    "tags": [
      ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
      ["k", "sell"],
      ["f", "VES"],
      ["s", "canceled-by-admin"],
      ["amt", "7851"],
      ["fa", "100"],
      ["pm", "face to face"],
      ["premium", "1"],
      ["y", "mostrop2p"],
      ["z", "order"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<p>And updates addressable dispute event with status <code>seller-refunded</code>:</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "098e8622eae022a79bc793984fccbc5ea3f6641bdcdffaa031c00d3bd33ca5a0",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1703274022,
    "kind": 38383,
    "tags": [
      ["d", "efc75871-2568-40b9-a6ee-c382d4d6de01"],
      ["s", "seller-refunded"],
      ["y", "mostrop2p"],
      ["z", "dispute"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;"
  }
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="admin-add-solver"><a class="header" href="#admin-add-solver">Admin add solver</a></h1>
<p>Solvers are users appointed by the Mostro administrator and are responsible for resolving disputes.</p>
<p>The administrator can add or remove them at any time.</p>
<p>The administrator can also solve disputes.</p>
<p>To add a solver the admin will need to send an <code>order</code> message to Mostro with action <code>admin-add-solver</code>:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "action": "admin-add-solver",
    "payload": {
      "text_message": "npub1qqq884wtp2jn96lqhqlnarl4kk3rmvrc9z2nmrvqujx3m4l2ea5qd5d0fq"
    }
  }
}
</code></pre>
<h2 id="mostro-response-12"><a class="header" href="#mostro-response-12">Mostro response</a></h2>
<p>Mostro will send this message to the admin:</p>
<pre><code class="language-json">{
  "order": {
    "version": 1,
    "action": "admin-add-solver",
    "payload": null
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="actions"><a class="header" href="#actions">Actions</a></h1>
<h2 id="mostro_coreaction"><a class="header" href="#mostro_coreaction">mostro_core::Action</a></h2>
<p>Action is used to identify each message between Mostro and users</p>
<p>You can see details in <a href="https://docs.rs/mostro-core/latest/mostro_core/message/enum.Action.html">mostro core documentation</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="message-suggestions-for-some-actions"><a class="header" href="#message-suggestions-for-some-actions">Message suggestions for some actions</a></h1>
<p>Here are suggestions for messages that clients could show to users when they receive certain actions. Clients can customize these messages to their convenience, as well as translate them, add emojis or any other modifications they consider necessary to provide a good user experience. Clients must complete the information that is in <code>monospace</code> format.</p>
<ul>
<li>
<p><strong>new-order:</strong> Your offer has been published! Please wait until another user picks your order. It will be available for <code>expiration_hours</code> hours. You can cancel this order before another user picks it up by executing: <code>cancel</code>.</p>
</li>
<li>
<p><strong>canceled:</strong> You have cancelled the order ID: <code>id</code>!</p>
</li>
<li>
<p><strong>pay-invoice:</strong> Please pay this hold invoice of <code>amount</code> Sats for <code>fiat_code</code> <code>fiat_amount</code> to start the operation. If you do not pay it within <code>expiration_seconds</code> the trade will be cancelled.</p>
</li>
<li>
<p><strong>add-invoice:</strong> Please send me an invoice for <code>amount</code> satoshis equivalent to  <code>fiat_code</code> <code>fiat_amount</code>.  This is where Ill send the funds upon completion of the trade. If you don't provide the invoice within <code>expiration_seconds</code> this trade will be cancelled.</p>
</li>
<li>
<p><strong>waiting-seller-to-pay:</strong> Please wait a bit. I've sent a payment request to the seller to sends the Sats for the order ID <code>id</code>. Once the payment is made, I'll connect you both. If the seller doesnt complete the payment within <code>expiration_seconds</code> minutes the trade will be cancelled.</p>
</li>
<li>
<p><strong>waiting-buyer-invoice:</strong> Payment received! Your Sats are now "held" in your own wallet. Please wait a bit. I've requested the buyer to provide an invoice. Once they do, I 'll connect you both. If they does not do so within <code>expiration_seconds</code> your Sats will be available at your wallet again and the trade will be cancelled.</p>
</li>
<li>
<p><strong>buyer-invoice-accepted:</strong> Invoice has been successfully saved!</p>
</li>
<li>
<p><strong>hold-invoice-payment-accepted:</strong> Get in touch with the seller, this is their npub <code>seller-npub</code> to get the details on how to send the fiat money for the order <code>id</code>, you must send <code>fiat_code</code> <code>fiat_amount</code> using <code>payment_method</code>. Once you send the fiat money, please let me know with <code>fiat-sent</code>.</p>
</li>
<li>
<p><strong>buyer-took-order:</strong> Get in touch with the buyer, this is their npub <code>buyer-npub</code> to inform them how to send you <code>fiat_code</code> <code>fiat_amount</code> through <code>payment_method</code>. I will notify you once the buyer indicates the fiat money has been sent. Afterward, you should verify if it has arrived. If the buyer does not respond, you can initiate a cancellation or a dispute. Remember, an administrator will NEVER contact you to resolve your order unless you open a dispute first.</p>
</li>
<li>
<p><strong>fiat-sent-ok:</strong></p>
<ul>
<li><em>To the buyer</em>:  I have informed to <code>seller-npub</code> that you have sent the fiat money. When the seller confirms they have received your fiat money, they should release the funds. If they refuse, you can open a dispute.</li>
<li><em>To the seller</em>: <code>buyer-npub</code> has informed that they have sent you the fiat money. Once you confirm receipt, please release the funds. After releasing, the money will go to the buyer and there will be no turning back, so only proceed if you are sure. If you want to release the Sats to the buyer, send me <code>release-order-message</code>.</li>
</ul>
</li>
<li>
<p><strong>released:</strong> <code>seller-npub</code> has already released the Sats! Expect your invoice to be paid any time. Remember your wallet needs to be online to receive through the Lightning Network.</p>
</li>
<li>
<p><strong>purchase-completed:</strong> Your satoshis purchase has been completed successfully. I have paid your invoice, enjoy sound money!</p>
</li>
<li>
<p><strong>hold-invoice-payment-settled:</strong> Your Sats sale has been completed after confirming the payment from <code>buyer-npub</code>.</p>
</li>
<li>
<p><strong>rate:</strong> Please qualify your counterparty</p>
</li>
<li>
<p><strong>rate-received:</strong> Rating successfully saved!</p>
</li>
<li>
<p><strong>cooperative-cancel-initiated-by-you:</strong> You have initiated the cancellation of the order ID: <code>id</code>. Your counterparty must agree to the cancellation too. If they do not respond, you can open a dispute. Note that no administrator will contact you regarding this cancellation unless you open a dispute first.</p>
</li>
<li>
<p><strong>cooperative-cancel-initiated-by-peer:</strong> Your counterparty wants to cancel order ID: <code>id</code>. Note that no administrator will contact you regarding this cancellation unless you open a dispute first. If you agree on such cancellation, please send me <code>cancel-order-message</code>.</p>
</li>
<li>
<p><strong>cooperative-cancel-accepted:</strong> Order <code>id</code> has been successfully cancelled!</p>
</li>
<li>
<p><strong>dispute-initiated-by-you:</strong> You have initiated a dispute for order Id: <code>id</code>.  A solver will be assigned to your dispute soon. Once assigned, I will share their npub with you, and only they will be able to assist you. You may contact the solver directly, but if they reach out first, please ask them to provide the token for your dispute. Your dispute token is: <code>user-token</code>.</p>
</li>
<li>
<p><strong>dispute-initiated-by-peer:</strong> Your counterparty has initiated a dispute for order Id: <code>${orderId}.</code> A solver will be assigned to your dispute soon. Once assigned, I will share their npub with you, and only they will be able to assist you. You may contact the solver directly, but if they reach out first, please ask them to provide the token for your dispute. Your dispute token is: <code>user-token</code>.</p>
</li>
<li>
<p><strong>admin-took-dispute:</strong></p>
<ul>
<li><em>To the admin</em>: Here are the details of the dispute order you have taken: <code>details</code>. You need to determine which user is correct and decide whether to cancel or complete the order. Please note that your decision will be final and cannot be reversed.</li>
<li><em>To the users</em>: The solver <code>admin-npub</code> will handle your dispute.  You can contact them directly, but if they reach out to you first, make sure to ask them for your dispute token.</li>
</ul>
</li>
<li>
<p><strong>admin-canceled:</strong></p>
<ul>
<li><em>To the admin</em>: You have cancelled the order ID: <code>id</code>!</li>
<li><em>To the users</em>: Admin has cancelled the order ID: <code>id</code>!</li>
</ul>
</li>
<li>
<p><strong>admin-settled:</strong></p>
<ul>
<li><em>To the admin</em>: You have completed the order ID: <code>id</code>!</li>
<li><em>To the users</em>: Admin has completed the order ID: <code>id</code>!</li>
</ul>
</li>
<li>
<p><strong>is-not-your-dispute:</strong> This dispute was not assigned to you!</p>
</li>
<li>
<p><strong>not-found:</strong> Dispute not found.</p>
</li>
<li>
<p><strong>payment-failed:</strong> I tried to send you the Sats but the payment of your invoice failed, I will try <code>payment_attempts</code> more times in <code>payment_retries_interval</code> minutes window. Please ensure your node/wallet is online.</p>
</li>
<li>
<p><strong>invoice-updated:</strong> Invoice has been successfully updated!</p>
</li>
<li>
<p><strong>hold-invoice-payment-canceled:</strong> The invoice was cancelled, your Sats will be available at your wallet again.</p>
</li>
<li>
<p><strong>cant-do:</strong> You are not allowed to <code>action</code> for this order!</p>
</li>
<li>
<p><strong>admin-add-solver:</strong> You have successfully added to the solver <code>npub</code>.</p>
</li>
<li>
<p><strong>is-not-your-order:</strong> You did not create this order and are not authorized to <code>action</code> it.</p>
</li>
<li>
<p><strong>not-allowed-by-status:</strong> You are not allowed to <code>action</code> because order Id <code>id</code> status is <code>order-status</code>.</p>
</li>
<li>
<p><strong>out-of-range-fiat-amount:</strong> The requested amount is incorrect and may be outside the acceptable range. The minimum is  <code>min_amount</code> and the maximum is <code>max_amount</code>.</p>
</li>
<li>
<p><strong>incorrect-invoice-amount:</strong></p>
<ul>
<li><em>If the buyer previously had sent the <code>new-order</code> action</em>:<br />
An invoice with non-zero amount was receive for the new order. Please send an invoice with a zero amount or no invoice at all.</li>
<li><em>If the buyer previously sent the <code>add-invoice</code> action</em>:<br />
The amount stated in the invoice is incorrect. Please send an invoice with an amount of <code>amount</code> satoshis, an invoice without an amount, or a lightning address.</li>
</ul>
</li>
<li>
<p><strong>invalid-sats-amount:</strong> That specified Sats amount is invalid.</p>
</li>
<li>
<p><strong>out-of-range-sats-amount:</strong> The allowed Sats amount for this Mostro is between min <code>min_order_amount</code> and max <code>max_order_amount</code>. Please enter an amount within this range.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="peer-to-peer-order-events-nip-69"><a class="header" href="#peer-to-peer-order-events-nip-69">Peer-to-peer Order events. NIP-69</a></h1>
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>Peer-to-peer (P2P) platforms have seen an upturn in recent years, while having more and more options is positive, in the specific case of p2p, having several options contributes to the liquidity split, meaning sometimes there's not enough assets available for trading. If we combine all these individual solutions into one big pool of orders, it will make them much more competitive compared to centralized systems, where a single authority controls the liquidity.</p>
<p>This NIP defines a simple standard for peer-to-peer order events, which enables the creation of a big liquidity pool for all p2p platforms participating.</p>
<h2 id="the-event"><a class="header" href="#the-event">The event</a></h2>
<p>Events are <a href="https://github.com/nostr-protocol/nips/blob/master/01.md#kinds">addressable events</a> and use <code>38383</code> as event kind, a p2p event look like this:</p>
<pre><code class="language-json">{
  "id": "&lt;Event id&gt;",
  "pubkey": "&lt;Mostro's pubkey&gt;",
  "created_at": 1702548701,
  "kind": 38383,
  "tags": [
    ["d", "ede61c96-4c13-4519-bf3a-dcf7f1e9d842"],
    ["k", "sell"],
    ["f", "VES"],
    ["s", "pending"],
    ["amt", "0"],
    ["fa", "100"],
    ["pm", "face to face", "bank transfer"],
    ["premium", "1"],
    [
      "rating",
      "{\"total_reviews\":1,\"total_rating\":3.0,\"last_rating\":3,\"max_rate\":5,\"min_rate\":1}"
    ],
    ["source", "https://t.me/p2plightning/xxxxxxx"],
    ["network", "mainnet"],
    ["layer", "lightning"],
    ["name", "Nakamoto"],
    ["g", "&lt;geohash&gt;"],
    ["bond", "0"],
    ["expiration", "1719391096"],
    ["y", "lnp2pbot"],
    ["z", "order"]
  ],
  "content": "",
  "sig": "&lt;Mostro's signature&gt;"
}
</code></pre>
<h2 id="tags"><a class="header" href="#tags">Tags</a></h2>
<ul>
<li><code>d</code> &lt; Order ID &gt;: A unique identifier for the order.</li>
<li><code>k</code> &lt; Order type &gt;: <code>sell</code> or <code>buy</code>. This specifies the type of transaction in terms of bitcoin. "sell" means selling bitcoin, while "buy" indicates buying bitcoin.</li>
<li><code>f</code> &lt; Currency &gt;: The fiat asset being traded, using the <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO 4217</a> standard.</li>
<li><code>s</code> &lt; Status &gt;: <code>pending</code>, <code>canceled</code>, <code>in-progress</code>, <code>success</code>.</li>
<li><code>amt</code> &lt; Amount &gt;: The amount of Bitcoin to be traded, the amount is defined in satoshis, if <code>0</code> means that the amount of satoshis will be obtained from a public API after the taker accepts the order.</li>
<li><code>fa</code> &lt; Fiat amount &gt;: The fiat amount being traded, for range orders two values are expected, the minimum and maximum amount.</li>
<li><code>pm</code> &lt; Payment method &gt;: The payment method used for the trade, if the order has multiple payment methods, they should be separated by a comma.</li>
<li><code>premium</code> &lt; Premium &gt;: The percentage of the premium the maker is willing to pay.</li>
<li><code>source</code> [Source]: The source of the order, it can be a URL that redirects to the order.</li>
<li><code>rating</code> [Rating]: The rating of the maker, this document does not define how the rating is calculated, it's up to the platform to define it.</li>
<li><code>network</code> &lt; Network &gt;: The network used for the trade, it can be <code>mainnet</code>, <code>testnet</code>, <code>signet</code>, etc.</li>
<li><code>layer</code> &lt; Layer &gt;: The layer used for the trade, it can be <code>onchain</code>, <code>lightning</code>, <code>liquid</code>, etc.</li>
<li><code>name</code> [Name]: The name of the maker.</li>
<li><code>g</code> [Geohash]: The geohash of the operation, it can be useful in a face to face trade.</li>
<li><code>bond</code> [Bond]: The bond amount, the bond is a security deposit that both parties must pay.</li>
<li><code>expiration</code> &lt; Expiration&gt;: The expiration date of the order (<a href="https://github.com/nostr-protocol/nips/blob/master/40.md">NIP-40</a>).</li>
<li><code>y</code> &lt; Platform &gt;: The platform that created the order.</li>
<li><code>z</code> &lt; Document &gt;: <code>order</code>.</li>
</ul>
<p>Mandatory tags are enclosed with <code>&lt;tag&gt;</code>, optional tags are enclosed with <code>[tag]</code>.</p>
<h2 id="implementations"><a class="header" href="#implementations">Implementations</a></h2>
<p>Currently implemented on the following platforms:</p>
<ul>
<li><a href="https://github.com/MostroP2P/mostro">Mostro</a></li>
<li><a href="https://github.com/lnp2pBot/bot">@lnp2pBot</a></li>
<li><a href="https://github.com/RoboSats/robosats/pull/1362">Robosats</a></li>
</ul>
<h2 id="this-document-is-inspired-on"><a class="header" href="#this-document-is-inspired-on">This document is inspired on</a></h2>
<ul>
<li><a href="https://mostro.network/protocol/">Mostro protocol specification</a></li>
<li><a href="https://github.com/nostr-protocol/nips/blob/8250274a22f4882f621510df0054fd6167c10c9e/31001.md">Messages specification for peer 2 peer NIP proposal</a></li>
<li><a href="https://github.com/nobu-maeda/n3xb">n3xB</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="other-events-published-by-mostro"><a class="header" href="#other-events-published-by-mostro">Other events published by Mostro</a></h1>
<p>Each Mostro instance periodically publishes events with relevant information about its status, such as the code version it is using, the latest commit, the fees it charges, allowed exchange limits, the relays it publishes to, and much more. Below, we provide details on these events.</p>
<h2 id="mostro-instance-status"><a class="header" href="#mostro-instance-status">Mostro Instance Status</a></h2>
<p>This event contains specific data about a Mostro instance. The instance is identified by the label <code>mostro_pubkey</code>.</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "id": "&lt;Event id&gt;",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "kind": 38383
    "tags": [
      [
        "d",
        "info-&lt;Mostro's pubkey&gt;"
      ],
      [
        "mostro_pubkey",
        "&lt;Mostro's pubkey&gt;"
      ],
      ["mostro_version", "0.12.8"],
      ["mostro_commit_id", "69052b2adba6c006e6929afda27f041a427f58f8"],
      ["max_order_amount", "20000"],
      ["min_order_amount", "100"],
      ["expiration_hours", "24"],
      ["expiration_seconds", "900"],
      ["fee", "0.006"],
      ["pow", "0"],
      ["hold_invoice_expiration_window", "900"],
      ["hold_invoice_cltv_delta", "298"],
      ["invoice_expiration_window", "900"],
      ["y", "mostrop2p"],
      ["z", "info"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;",
    "created_at": 1731701441,
  }
]
</code></pre>
<p>Below is an explanation of the meaning of some of the labels in this event, all of which can be modified by anyone running a Mostro instance.</p>
<ul>
<li><code>mostro_version</code>: The version of the Mostro daemon running on the instance.</li>
<li><code>mostro_commit_id</code>: The ID of the last commit used by the instance.</li>
<li><code>max_order_amount</code>: The maximum amount of Satoshis allowed for exchange.</li>
<li><code>min_order_amount</code>: The minimum amount of Satoshis allowed for exchange.</li>
<li><code>expiration_hours</code>: The maximum time, in hours, that an order can remain in <code>pending</code> status before it expires.</li>
<li><code>expiration_seconds</code>: The maximum time, in seconds, that an order can remain in <code>waiting-payment</code> or <code>waiting-buyer-invoice</code> status before being canceled or reverted to <code>pending</code> status.</li>
<li><code>fee</code>: The fee percentage charged by the instance. For example, "0.006" means a 0.6% fee.</li>
<li><code>pow</code>: The Proof of Work required of incoming events.</li>
<li><code>hold_invoice_expiration_window</code>: The maximum time, in seconds, for the hold invoice issued by Mostro to be paid by the seller.</li>
<li><code>hold_invoice_cltv_delta</code>: The number of blocks in which the Mostro hold invoice will expire.</li>
<li><code>invoice_expiration_window</code>: The maximum time, in seconds, for a buyer to submit an invoice to Mostro.</li>
</ul>
<h2 id="information-about-the-relays-where-events-are-published"><a class="header" href="#information-about-the-relays-where-events-are-published">Information about the Relays Where Events Are Published</a></h2>
<p>The operator of a Mostro instance decides which relays the events from that instance are published to. This information can be accessed in events <a href="https://github.com/nostr-protocol/nips/blob/master/65.md">kind 10002</a>, which are published by the Mostro instances.</p>
<pre><code class="language-json">[
  "EVENT",
  "RAND",
  {
    "tags": [
      ["r", "wss://relay.mostro.network/"],
      ["r", "wss://nostr.bilthon.dev/"]
    ],
    "content": "",
    "sig": "&lt;Mostro's signature&gt;",
    "id": "7a31879cbb4f32b86ca535912ba568722c52845e1517468249b66f9af6eff05c",
    "pubkey": "&lt;Mostro's pubkey&gt;",
    "created_at": 1731680102,
    "kind": 10002
  }
]
</code></pre>
<p>The <code>r</code> label indicates the relays through which the Mostro instance is publishing its events.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
